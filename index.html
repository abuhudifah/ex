<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø´Ø±ÙƒØ© Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100%;
            overflow-x: hidden;
        }
        
        .admin-gradient {
            background: linear-gradient(135deg, #0d3b66 0%, #1e5f8b 100%);
        }
        
        .modern-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #60a5fa 100%);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo-container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .admin-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .tab-active { 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
        }
        
        .tab-inactive { 
            background: rgba(255, 255, 255, 0.9);
            color: #1e3a8a;
            transition: all 0.3s ease;
        }
        
        .tab-inactive:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .loading { 
            display: inline-block; 
            width: 20px; 
            height: 20px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #1e3a8a; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        .agent-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .agent-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .btn-admin {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }
        
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 58, 138, 0.4);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border: 2px solid rgba(30, 58, 138, 0.1);
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: #1e3a8a;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .success-toast {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            backdrop-filter: blur(10px);
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .transaction-row {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .transaction-row:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateX(-3px);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            position: relative;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .header-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }
        
        .header-main {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
            justify-content: center;
        }
        
        .header-info {
            width: 100%;
            max-width: 300px;
        }
        
        @media (min-width: 768px) {
            .header-container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-main {
                width: auto;
                justify-content: flex-start;
            }
            
            .header-info {
                width: auto;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .modern-header {
                padding: 1rem;
            }
            
            .modern-header .container {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .logo-container {
                width: 60px;
                height: 60px;
            }
            
            .logo-container img {
                width: 100%;
                height: 100%;
            }
            
            .modern-header h1 {
                font-size: 1.5rem;
            }
            
            .modern-header p {
                font-size: 0.9rem;
            }
            
            nav {
                padding: 0.5rem;
            }
            
            .tab-button {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
                white-space: nowrap;
            }
            
            main {
                padding: 1rem;
            }
            
            .grid {
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-card .text-3xl {
                font-size: 1.5rem;
            }
            
            .chart-container {
                padding: 1rem;
                margin-bottom: 1rem;
            }
            
            .admin-card {
                padding: 1.5rem;
            }
            
            .admin-card .text-3xl {
                font-size: 1.5rem;
            }
            
            .filter-card .grid {
                grid-template-columns: 1fr;
            }
            
            .transaction-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .transaction-row .text-left {
                margin-top: 0.5rem;
                align-self: flex-end;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            table th, table td {
                padding: 0.5rem;
            }
            
            .btn-admin, .bg-green-600, .bg-red-600, .bg-orange-600 {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }
            
            #agentsList, #adminAccountsList {
                grid-template-columns: 1fr;
            }
            
            #shareModal .glass-card {
                margin: 1rem;
                padding: 1.5rem;
            }
            
            .success-toast {
                top: 1rem;
                left: 1rem;
                right: 1rem;
                padding: 1rem;
            }
            
            @media (max-width: 480px) {
                .tab-button {
                    padding: 0.5rem 0.75rem;
                    font-size: 0.7rem;
                }
                
                .stat-card .text-3xl {
                    font-size: 1.25rem;
                }
                
                .admin-card {
                    padding: 1rem;
                }
                
                .chart-wrapper {
                    height: 200px;
                }
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            #agentsList, #adminAccountsList {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid.md\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .header-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .btn-edit {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn-share {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        /* ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ */
        .statement-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .statement-table th,
        .statement-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .statement-table th {
            background-color: #f8fafc;
            font-weight: 600;
        }
        
        .statement-table tr:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="min-h-full">
    <!-- Admin Header - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
    <header class="modern-header text-white p-4 md:p-6 header-glow">
        <div class="container mx-auto header-container">
            <div class="header-main">
                <div class="logo-container rounded-full p-1 md:p-2">
                    <img src="https://i.ibb.co/ZzzbL3Rg/image.png" alt="Ø´Ø¹Ø§Ø± Ø´Ø±ÙƒØ© Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ©" class="h-12 w-12 md:h-16 md:w-16 rounded-full object-cover">
                </div>
                <div class="text-center md:text-right">
                    <h1 class="text-xl md:text-3xl font-bold mb-1">ğŸ¢ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
                    <p class="text-sm md:text-xl opacity-90">Ù†Ø¸Ø§Ù… Ø£Ø¨Ùˆ Ø­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</p>
                </div>
            </div>
            <div class="header-info">
                <div class="info-card rounded-xl p-3 md:p-4 text-center md:text-right">
                    <p class="text-base md:text-lg font-semibold">ğŸ‘¨â€ğŸ’¼ Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    <p class="text-xs md:text-sm opacity-90" id="currentDate"></p>
                    <p class="text-xs opacity-75" id="currentTime"></p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-transparent p-2 md:p-4">
        <div class="container mx-auto">
            <div class="flex overflow-x-auto space-x-1 md:space-x-2 space-x-reverse pb-2">
                <button onclick="showTab('dashboard')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-active transition-all" id="tab-dashboard">
                    <i class="fas fa-chart-pie ml-1 md:ml-2"></i>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
                </button>
                <button onclick="showTab('agents')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-agents">
                    <i class="fas fa-users ml-1 md:ml-2"></i>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
                </button>
                <button onclick="showTab('transactions')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-transactions">
                    <i class="fas fa-list ml-1 md:ml-2"></i>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
                </button>
                <button onclick="showTab('accounts')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-accounts">
                    <i class="fas fa-university ml-1 md:ml-2"></i>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©
                </button>
                <button onclick="showTab('reports')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-reports">
                    <i class="fas fa-file-alt ml-1 md:ml-2"></i>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </button>
                <button onclick="showTab('analytics')" class="tab-button px-3 md:px-6 py-2 md:py-4 whitespace-nowrap rounded-xl tab-inactive" id="tab-analytics">
                    <i class="fas fa-chart-line ml-1 md:ml-2"></i>Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-3 md:p-6">
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content fade-in">
            <!-- Summary Cards -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                    <div class="bg-blue-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                        <i class="fas fa-users text-blue-600 text-lg md:text-2xl"></i>
                    </div>
                    <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h3>
                    <p class="text-xl md:text-3xl font-bold text-blue-600" id="totalAgents">0</p>
                </div>
                <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                    <div class="bg-green-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                        <i class="fas fa-money-bill-wave text-green-600 text-lg md:text-2xl"></i>
                    </div>
                    <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <p class="text-xl md:text-3xl font-bold text-green-600" id="todayCollectionsAmount">0</p>
                    <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                </div>
                <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                    <div class="bg-purple-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                        <i class="fas fa-university text-purple-600 text-lg md:text-2xl"></i>
                    </div>
                    <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <p class="text-xl md:text-3xl font-bold text-purple-600" id="todayDepositsAmount">0</p>
                    <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                </div>
                <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                    <div class="bg-red-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                        <i class="fas fa-receipt text-red-600 text-lg md:text-2xl"></i>
                    </div>
                    <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <p class="text-xl md:text-3xl font-bold text-red-600" id="todayExpensesAmount">0</p>
                    <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                </div>
            </div>

            <!-- Charts Section - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 mb-6 md:mb-8">
                <div class="chart-container">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="chart-wrapper">
                        <canvas id="transactionChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ“ˆ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="chart-wrapper">
                        <canvas id="agentPerformanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 md:mb-6">
                    <div class="flex items-center mb-3 md:mb-0">
                        <div class="bg-indigo-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                            <i class="fas fa-clock text-indigo-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                            <p class="text-sm md:text-gray-600">Ø¢Ø®Ø± 10 Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                    </div>
                    <button onclick="refreshDashboard()" class="btn-admin text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold self-start md:self-auto">
                        <i class="fas fa-sync-alt ml-1 md:ml-2"></i>ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
                <div id="recentActivity" class="space-y-3 md:space-y-4"></div>
            </div>
        </div>

        <!-- Agents Tab -->
        <div id="agents-tab" class="tab-content hidden">
            <div class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 md:mb-8">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                            <i class="fas fa-users text-blue-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h2>
                            <p class="text-sm md:text-gray-600">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-2 md:gap-3">
                        <button onclick="exportAgentsReport()" class="btn-admin text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                            <i class="fas fa-download ml-1 md:ml-2"></i>ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="showAddAgentModal()" class="bg-green-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                            <i class="fas fa-plus ml-1 md:ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨
                        </button>
                    </div>
                </div>
                
                <!-- Date Filter for Agents -->
                <div class="filter-card rounded-xl md:rounded-2xl p-4 md:p-6 mb-6">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ“… ÙÙ„ØªØ±Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ø§Ø®ØªØ± ÙŠÙˆÙ… Ù…Ø­Ø¯Ø¯</label>
                            <input type="date" id="agentsDate" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="updateAgentsDate()">
                        </div>
                        <div class="flex items-end">
                            <button onclick="showTodayAgents()" class="w-full btn-admin text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                                <i class="fas fa-calendar-day ml-1 md:ml-2"></i>Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button onclick="resetAgentsDate()" class="w-full bg-gray-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold hover:bg-gray-700 transition-all text-sm md:text-base">
                                <i class="fas fa-redo ml-1 md:ml-2"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>
                    <div class="mt-3 md:mt-4 text-xs md:text-sm text-gray-600">
                        <i class="fas fa-info-circle ml-1 md:ml-2"></i>
                        <span id="agentsDateInfo">ÙŠØªÙ… Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·</span>
                    </div>
                </div>
                
                <div id="agentsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions-tab" class="tab-content hidden">
            <div class="space-y-4 md:space-y-6">
                <!-- Filters -->
                <div class="filter-card rounded-xl md:rounded-2xl p-4 md:p-6">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ” ÙÙ„ØªØ±Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                            <select id="filterAgent" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="filterTransactions()">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                            <select id="filterType" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="filterTransactions()">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                                <option value="collection">ØªØ­ØµÙŠÙ„</option>
                                <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹</option>
                                <option value="expense">Ù…ØµØ±ÙˆÙ</option>
                                <option value="delivery">Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">ÙŠÙˆÙ… Ù…Ø­Ø¯Ø¯</label>
                            <input type="date" id="filterSpecificDate" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="filterTransactions()">
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="filterFromDate" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="filterTransactions()">
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="filterToDate" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="filterTransactions()">
                        </div>
                    </div>
                </div>

                <!-- Transactions List -->
                <div class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4 md:mb-6">
                        <div class="flex items-center mb-3 md:mb-0">
                            <div class="bg-green-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                                <i class="fas fa-list text-green-600 text-lg md:text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
                                <p class="text-sm md:text-gray-600" id="transactionsCount">0 Ù…Ø¹Ø§Ù…Ù„Ø©</p>
                            </div>
                        </div>
                        <div class="flex space-x-2 md:space-x-3 space-x-reverse mt-2 md:mt-0">
                            <button onclick="exportTransactionsToExcel()" class="bg-green-600 text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-semibold hover:bg-green-700 transition-all text-sm md:text-base">
                                <i class="fas fa-file-excel ml-1 md:ml-2"></i>Excel
                            </button>
                            <button onclick="exportTransactionsToPDF()" class="bg-red-600 text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-semibold hover:bg-red-700 transition-all text-sm md:text-base">
                                <i class="fas fa-file-pdf ml-1 md:ml-2"></i>PDF
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-full">
                            <thead>
                                <tr class="bg-gray-50 text-gray-700">
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th>
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th class="p-2 md:p-4 text-right font-semibold text-xs md:text-base">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bank Accounts Tab -->
        <div id="accounts-tab" class="tab-content hidden">
            <div class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6 md:mb-8">
                    <div class="flex items-center mb-4 md:mb-0">
                        <div class="bg-purple-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                            <i class="fas fa-university text-purple-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</h2>
                            <p class="text-sm md:text-gray-600">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</p>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-3 space-x-reverse mt-2 md:mt-0">
                        <button onclick="shareAllAccountsReport()" class="btn-admin text-white px-3 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base mt-2 md:mt-0">
                            <i class="fas fa-share-alt ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                </div>
                
                <!-- Date Filter for Bank Accounts -->
                <div class="filter-card rounded-xl md:rounded-2xl p-4 md:p-6 mb-6">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ“… ÙÙ„ØªØ±Ø© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4">
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ø§Ø®ØªØ± ÙŠÙˆÙ… Ù…Ø­Ø¯Ø¯</label>
                            <input type="date" id="bankAccountsDate" class="w-full p-2 md:p-3 form-input rounded-xl" onchange="updateBankAccountsDate()">
                        </div>
                        <div class="flex items-end">
                            <button onclick="showTodayBankAccounts()" class="w-full btn-admin text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base">
                                <i class="fas fa-calendar-day ml-1 md:ml-2"></i>Ø¹Ø±Ø¶ Ø§Ù„ÙŠÙˆÙ…
                            </button>
                        </div>
                        <div class="flex items-end">
                            <button onclick="resetBankAccountsDate()" class="w-full bg-gray-600 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold hover:bg-gray-700 transition-all text-sm md:text-base">
                                <i class="fas fa-redo ml-1 md:ml-2"></i>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>
                    <div class="mt-3 md:mt-4 text-xs md:text-sm text-gray-600">
                        <i class="fas fa-info-circle ml-1 md:ml-2"></i>
                        <span id="bankAccountsDateInfo">ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·</span>
                    </div>
                </div>
                
                <div id="adminAccountsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"></div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports-tab" class="tab-content hidden">
            <div class="space-y-6 md:space-y-8">
                <!-- Report Generator -->
                <div class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8">
                    <div class="flex items-center mb-4 md:mb-6">
                        <div class="bg-indigo-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                            <i class="fas fa-file-alt text-indigo-600 text-lg md:text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl md:text-3xl font-bold text-gray-800">Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h2>
                            <p class="text-sm md:text-gray-600">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø®ØµØµØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-6">
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                            <select id="reportType" class="w-full p-2 md:p-3 form-input rounded-xl">
                                <option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
                                <option value="weekly">ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                                <option value="monthly">ØªÙ‚Ø±ÙŠØ± Ø´Ù‡Ø±ÙŠ</option>
                                <option value="custom">ÙØªØ±Ø© Ù…Ø®ØµØµØ©</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="reportFromDate" class="w-full p-2 md:p-3 form-input rounded-xl">
                        </div>
                        <div>
                            <label class="block text-xs md:text-sm font-semibold text-gray-700 mb-1 md:mb-2">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="reportToDate" class="w-full p-2 md:p-3 form-input rounded-xl">
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 space-x-reverse">
                        <button onclick="generateReport()" class="btn-admin text-white px-4 md:px-8 py-2 md:py-4 rounded-xl font-semibold text-sm md:text-lg">
                            <i class="fas fa-chart-bar ml-1 md:ml-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button onclick="shareGeneratedReport()" class="bg-green-600 text-white px-4 md:px-8 py-2 md:py-4 rounded-xl font-semibold text-sm md:text-lg hover:bg-green-700 transition-all mt-2 md:mt-0">
                            <i class="fas fa-share-alt ml-1 md:ml-2"></i>Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                    </div>
                </div>

                <!-- Generated Report -->
                <div id="generatedReport" class="admin-card rounded-xl md:rounded-2xl p-4 md:p-8 hidden">
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4 md:mb-6">ğŸ“‹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙÙ†Ø´Ø£</h3>
                    <div id="reportContent"></div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content hidden">
            <div class="space-y-6 md:space-y-8">
                <!-- Performance Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-6">
                    <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-green-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                            <i class="fas fa-trending-up text-green-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
                        <p class="text-xl md:text-3xl font-bold text-green-600" id="avgDailyCollection">0</p>
                        <p class="text-xs md:text-sm text-gray-500">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>
                    </div>
                    <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-blue-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                            <i class="fas fa-user-check text-blue-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ø£ÙØ¶Ù„ Ù…Ù†Ø¯ÙˆØ¨</h3>
                        <p class="text-lg md:text-xl font-bold text-blue-600" id="topAgent">-</p>
                        <p class="text-xs md:text-sm text-gray-500" id="topAgentAmount">0 Ø±ÙŠØ§Ù„</p>
                    </div>
                    <div class="stat-card rounded-xl md:rounded-2xl p-3 md:p-6 text-center">
                        <div class="bg-purple-100 w-12 h-12 md:w-16 md:h-16 rounded-full flex items-center justify-center mx-auto mb-2 md:mb-4">
                            <i class="fas fa-percentage text-purple-600 text-lg md:text-2xl"></i>
                        </div>
                        <h3 class="text-sm md:text-lg font-semibold text-gray-700 mb-1 md:mb-2">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</h3>
                        <p class="text-xl md:text-3xl font-bold text-purple-600" id="depositRate">0%</p>
                        <p class="text-xs md:text-sm text-gray-500">Ù…Ù† Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª</p>
                    </div>
                </div>

                <!-- Advanced Charts - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8">
                    <div class="chart-container">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ“Š Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
                        <div class="chart-wrapper">
                            <canvas id="monthlyTrendsChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-3 md:mb-4">ğŸ¦ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©</h3>
                        <div class="chart-wrapper">
                            <canvas id="bankUsageChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success Message -->
    <div id="successMessage" class="fixed top-4 md:top-6 left-4 md:left-6 right-4 md:right-6 success-toast text-white p-4 md:p-6 rounded-xl md:rounded-2xl hidden z-50">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-xl md:text-2xl ml-2 md:ml-3"></i>
            <p id="successText" class="text-base md:text-lg font-semibold"></p>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="glass-card rounded-xl md:rounded-2xl p-4 md:p-8 w-full max-w-4xl mx-2 md:mx-4 max-h-80 md:max-h-96 overflow-y-auto">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                    <i class="fas fa-share-alt text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
            </div>
            <textarea id="shareText" class="w-full h-40 md:h-80 p-3 md:p-4 form-input rounded-xl text-right" readonly></textarea>
            <div class="flex flex-col md:flex-row gap-2 md:gap-4 mt-4 md:mt-6">
                <button onclick="copyToClipboard()" class="flex-1 btn-admin text-white py-2 md:py-4 rounded-xl font-semibold text-sm md:text-base">
                    <i class="fas fa-copy ml-1 md:ml-2"></i>Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                </button>
                <button onclick="hideShareModal()" class="flex-1 bg-gray-500 text-white py-2 md:py-4 rounded-xl font-semibold hover:bg-gray-600 transition-colors text-sm md:text-base mt-2 md:mt-0">
                    <i class="fas fa-times ml-1 md:ml-2"></i>Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="editTransactionModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="glass-card rounded-xl md:rounded-2xl p-4 md:p-8 w-full max-w-2xl mx-2 md:mx-4 max-h-80 md:max-h-96 overflow-y-auto">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                    <i class="fas fa-edit text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</h3>
            </div>
            <form id="editTransactionForm" class="space-y-4 md:space-y-6">
                <input type="hidden" id="editTransactionId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©</label>
                        <select id="editTransactionType" class="w-full p-3 form-input rounded-xl" onchange="toggleEditTransactionFields()">
                            <option value="collection">ØªØ­ØµÙŠÙ„</option>
                            <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹</option>
                            <option value="expense">Ù…ØµØ±ÙˆÙ</option>
                            <option value="delivery">Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ø¨Ù„Øº</label>
                        <input type="number" id="editTransactionAmount" class="w-full p-3 form-input rounded-xl" required>
                    </div>
                    <div id="editCollectionFields" class="md:col-span-2 space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                            <input type="text" id="editCustomerName" class="w-full p-3 form-input rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„ØªØ­ØµÙŠÙ„</label>
                            <select id="editCollectionType" class="w-full p-3 form-input rounded-xl">
                                <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ</option>
                                <option value="Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</option>
                                <option value="Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰">Ø§Ø³ØªÙ„Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                    </div>
                    <div id="editDepositFields" class="md:col-span-2 hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
                        <select id="editBankAccount" class="w-full p-3 form-input rounded-xl">
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>
                        </select>
                    </div>
                    <div id="editExpenseFields" class="md:col-span-2 hidden">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                            <select id="editExpenseType" class="w-full p-3 form-input rounded-xl">
                                <option value="ÙˆÙ‚ÙˆØ¯">ÙˆÙ‚ÙˆØ¯</option>
                                <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„ÙˆØµÙ</label>
                            <input type="text" id="editExpenseDescription" class="w-full p-3 form-input rounded-xl">
                        </div>
                    </div>
                    <div id="editDeliveryFields" class="md:col-span-2 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                                <select id="editDeliveryType" class="w-full p-3 form-input rounded-xl">
                                    <option value="receive">Ø§Ø³ØªÙ„Ø§Ù…</option>
                                    <option value="send">ØªØ³Ù„ÙŠÙ…</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                                <select id="editDeliveryAgent" class="w-full p-3 form-input rounded-xl">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                        <textarea id="editTransactionNotes" class="w-full p-3 form-input rounded-xl" rows="3"></textarea>
                    </div>
                </div>
                <div class="flex flex-col md:flex-row gap-2 md:gap-4 mt-4 md:mt-6">
                    <button type="submit" class="flex-1 btn-admin text-white py-3 rounded-xl font-semibold">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    </button>
                    <button type="button" onclick="hideEditTransactionModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Agent Modal -->
    <div id="addAgentModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="glass-card rounded-xl md:rounded-2xl p-4 md:p-8 w-full max-w-md mx-2 md:mx-4">
            <div class="flex items-center mb-4 md:mb-6">
                <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                    <i class="fas fa-user-plus text-blue-600 text-lg md:text-xl"></i>
                </div>
                <h3 class="text-xl md:text-2xl font-bold text-gray-800">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯</h3>
            </div>
            <form id="addAgentForm" class="space-y-4 md:space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</label>
                    <input type="text" id="newAgentName" class="w-full p-3 form-input rounded-xl" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="newAgentEmail" class="w-full p-3 form-input rounded-xl">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="newAgentPhone" class="w-full p-3 form-input rounded-xl">
                </div>
                <div class="flex flex-col md:flex-row gap-2 md:gap-4 mt-4 md:mt-6">
                    <button type="submit" class="flex-1 btn-admin text-white py-3 rounded-xl font-semibold">
                        <i class="fas fa-save ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                    </button>
                    <button type="button" onclick="hideAddAgentModal()" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold hover:bg-gray-600 transition-colors">
                        <i class="fas fa-times ml-2"></i>Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Agent Statement Modal -->
    <div id="agentStatementModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden p-2 md:p-4">
        <div class="glass-card rounded-xl md:rounded-2xl p-4 md:p-8 w-full max-w-6xl mx-2 md:mx-4 max-h-96 md:max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4 md:mb-6">
                <div class="flex items-center">
                    <div class="bg-blue-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                        <i class="fas fa-file-invoice text-blue-600 text-lg md:text-xl"></i>
                    </div>
                    <h3 class="text-xl md:text-2xl font-bold text-gray-800" id="statementTitle">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ù…Ù†Ø¯ÙˆØ¨</h3>
                </div>
                <button onclick="hideAgentStatementModal()" class="bg-gray-500 text-white p-2 rounded-full hover:bg-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="agentStatementContent" class="space-y-4">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZ9IUXRK-5Kb-TWhQL9nuwse_lmdCzP9g",
            authDomain: "abu-hatheefa-app-68ff1.firebaseapp.com",
            projectId: "abu-hatheefa-app-68ff1",
            storageBucket: "abu-hatheefa-app-68ff1.firebasestorage.app",
            messagingSenderId: "33088080519",
            appId: "1:33088080519:web:d7ee753b3751a0d2828622"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Global Variables
        let allTransactions = [];
        let allAgents = [];
        let allBankAccounts = [];
        let filteredTransactions = [];
        let charts = {};
        let selectedBankAccountsDate = new Date().toISOString().split('T')[0];
        let selectedAgentsDate = new Date().toISOString().split('T')[0];

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø¨Ø¯ÙˆÙ† ÙƒØ³ÙˆØ±
        function formatAmount(amount) {
            return Math.round(amount).toString();
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
        function formatDateTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
        async function calculatePreviousDayBalance(agentName, selectedDate) {
            try {
                const selectedDateObj = new Date(selectedDate);
                const previousDate = new Date(selectedDateObj);
                previousDate.setDate(previousDate.getDate() - 1);
                const previousDateStr = previousDate.toISOString().split('T')[0];

                // Ø¬Ù„Ø¨ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨
                const previousDayTransactions = allTransactions.filter(t => {
                    if (!t.timestamp || t.agent !== agentName) return false;
                    const transactionDate = new Date(t.timestamp.toDate ? 
                        t.timestamp.toDate() : t.timestamp);
                    return transactionDate.toISOString().split('T')[0] === previousDateStr;
                });

                const collections = previousDayTransactions.filter(t => t.type === 'collection');
                const deposits = previousDayTransactions.filter(t => t.type === 'deposit');
                const expenses = previousDayTransactions.filter(t => t.type === 'expense');
                const deliveries = previousDayTransactions.filter(t => t.type === 'delivery');
                
                const totalCollections = collections.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalDeposits = deposits.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalExpenses = expenses.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === agentName);
                const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === agentName);
                
                const totalReceived = receivedDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalSent = sentDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
                const previousBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
                
                return previousBalance;
            } catch (error) {
                console.error('Error calculating previous day balance:', error);
                return 0;
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDateTime();
            loadAllData();
            
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ
            document.getElementById('bankAccountsDate').value = selectedBankAccountsDate;
            document.getElementById('agentsDate').value = selectedAgentsDate;
            
            // Update time every second
            setInterval(updateCurrentDateTime, 1000);
            
            // Auto refresh every 30 seconds
            setInterval(loadAllData, 30000);
            
            // Auto reset limits at start of new day
            checkAndResetLimits();

            // Setup edit form listener
            document.getElementById('editTransactionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateTransaction();
            });

            // Setup add agent form listener
            document.getElementById('addAgentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewAgent();
            });
        });

        function updateCurrentDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        async function checkAndResetLimits() {
            const lastReset = localStorage.getItem('lastResetDate');
            const today = new Date().toDateString();
            
            if (lastReset !== today) {
                await resetAllLimits();
                localStorage.setItem('lastResetDate', today);
            }
        }

        async function loadAllData() {
            try {
                // Load all data in parallel
                await Promise.all([
                    loadTransactions(),
                    loadAgents(),
                    loadBankAccounts()
                ]);
                
                updateDashboard();
                updateAgentsList();
                updateTransactionsList();
                updateBankAccountsList();
                updateAnalytics();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        async function loadTransactions() {
            try {
                const snapshot = await db.collection('transactions').orderBy('timestamp', 'desc').get();
                allTransactions = [];
                
                snapshot.forEach(doc => {
                    allTransactions.push({ id: doc.id, ...doc.data() });
                });
                
                filteredTransactions = [...allTransactions];
                
            } catch (error) {
                console.error('Error loading transactions:', error);
            }
        }

        async function loadAgents() {
            try {
                const snapshot = await db.collection('agents').get();
                allAgents = [];
                
                snapshot.forEach(doc => {
                    allAgents.push({ id: doc.id, ...doc.data() });
                });
                
                // Update filter dropdown
                const filterSelect = document.getElementById('filterAgent');
                filterSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</option>';
                
                allAgents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.name;
                    option.textContent = agent.name;
                    filterSelect.appendChild(option);
                });

                // Update edit delivery agent dropdown
                const editDeliveryAgent = document.getElementById('editDeliveryAgent');
                editDeliveryAgent.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</option>';
                
                allAgents.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.name;
                    option.textContent = agent.name;
                    editDeliveryAgent.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading agents:', error);
            }
        }

        async function loadBankAccounts() {
            try {
                const snapshot = await db.collection('bankAccounts').get();
                allBankAccounts = [];
                
                snapshot.forEach(doc => {
                    allBankAccounts.push({ id: doc.id, ...doc.data() });
                });

                // Update edit bank account dropdown
                const editBankAccount = document.getElementById('editBankAccount');
                editBankAccount.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</option>';
                
                allBankAccounts.forEach(account => {
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = `${account.name} - ${account.number}`;
                    editBankAccount.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading bank accounts:', error);
            }
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            document.getElementById('tab-' + tabName).classList.remove('tab-inactive');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
            
            // Load specific data for tabs
            if (tabName === 'analytics') {
                setTimeout(updateCharts, 100);
            } else if (tabName === 'accounts') {
                updateBankAccountsList();
            } else if (tabName === 'agents') {
                updateAgentsList();
            }
        }

        function updateDashboard() {
            // Filter today's transactions only
            const today = new Date().toISOString().split('T')[0];
            const todayTransactions = allTransactions.filter(transaction => {
                if (!transaction.timestamp) return false;
                const transactionDate = new Date(transaction.timestamp.toDate ? 
                    transaction.timestamp.toDate() : transaction.timestamp);
                return transactionDate.toISOString().split('T')[0] === today;
            });

            // Calculate totals for today only
            const collections = todayTransactions.filter(t => t.type === 'collection');
            const deposits = todayTransactions.filter(t => t.type === 'deposit');
            const expenses = todayTransactions.filter(t => t.type === 'expense');
            const deliveries = todayTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalDeliveries = deliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
            
            // Update summary cards with today's data only
            document.getElementById('totalAgents').textContent = allAgents.length;
            document.getElementById('todayCollectionsAmount').textContent = formatAmount(totalCollections);
            document.getElementById('todayDepositsAmount').textContent = formatAmount(totalDeposits);
            document.getElementById('todayExpensesAmount').textContent = formatAmount(totalExpenses);
            
            // Update recent activity with today's transactions only
            updateRecentActivity(todayTransactions);
            
            // Update charts with today's data only
            updateDashboardCharts(todayTransactions);
        }

        function updateRecentActivity(todayTransactions) {
            const recentActivity = document.getElementById('recentActivity');
            recentActivity.innerHTML = '';
            
            const recent = todayTransactions.slice(0, 10);
            
            if (recent.length === 0) {
                recentActivity.innerHTML = `
                    <div class="text-center py-8 md:py-12">
                        <i class="fas fa-inbox text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                        <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                    </div>
                `;
                return;
            }
            
            recent.forEach(transaction => {
                const div = document.createElement('div');
                div.className = 'transaction-row rounded-lg md:rounded-xl p-3 md:p-4 flex flex-col md:flex-row md:justify-between md:items-center';
                
                let iconClass = '';
                let colorClass = '';
                let typeText = '';
                let details = '';
                
                switch (transaction.type) {
                    case 'collection':
                        iconClass = 'fas fa-arrow-up';
                        colorClass = 'text-green-600';
                        typeText = 'ØªØ­ØµÙŠÙ„';
                        details = `Ù…Ù† ${transaction.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        
                        if (transaction.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && transaction.bankAccountName) {
                            details += ` - ${transaction.bankAccountName}`;
                        } else {
                            details += ` - ${transaction.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        }
                        break;
                    case 'deposit':
                        iconClass = 'fas fa-university';
                        colorClass = 'text-blue-600';
                        typeText = 'Ø¥ÙŠØ¯Ø§Ø¹';
                        details = `ÙÙŠ ${transaction.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        break;
                    case 'expense':
                        iconClass = 'fas fa-arrow-down';
                        colorClass = 'text-red-600';
                        typeText = 'Ù…ØµØ±ÙˆÙ';
                        details = transaction.description || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        break;
                    case 'delivery':
                        iconClass = 'fas fa-exchange-alt';
                        colorClass = 'text-purple-600';
                        typeText = transaction.deliveryType === 'receive' ? 'Ø§Ø³ØªÙ„Ø§Ù…' : 'ØªØ³Ù„ÙŠÙ…';
                        details = `Ù…Ù† ${transaction.fromAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} Ø¥Ù„Ù‰ ${transaction.toAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        break;
                }
                
                const time = formatDateTime(transaction.timestamp);
                
                div.innerHTML = `
                    <div class="flex items-center mb-2 md:mb-0">
                        <div class="bg-gray-100 p-2 md:p-3 rounded-full ml-2 md:ml-4">
                            <i class="${iconClass} ${colorClass}"></i>
                        </div>
                        <div>
                            <span class="font-bold ${colorClass}">${typeText}</span>
                            <span class="text-gray-600 block text-xs md:text-sm">${details}</span>
                            <span class="text-xs text-gray-500">Ø¨ÙˆØ§Ø³Ø·Ø© ${transaction.agent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                    </div>
                    <div class="text-left self-end md:self-auto">
                        <span class="font-bold text-base md:text-lg ${colorClass}">${formatAmount(transaction.amount || 0)}</span>
                        <span class="text-xs text-gray-500 block">${time}</span>
                    </div>
                `;
                
                recentActivity.appendChild(div);
            });
        }

        function updateDashboardCharts(todayTransactions) {
            // Transaction Distribution Chart for today only
            const ctx1 = document.getElementById('transactionChart').getContext('2d');
            
            if (charts.transactionChart) {
                charts.transactionChart.destroy();
            }
            
            const transactionCounts = {
                collection: todayTransactions.filter(t => t.type === 'collection').length,
                deposit: todayTransactions.filter(t => t.type === 'deposit').length,
                expense: todayTransactions.filter(t => t.type === 'expense').length,
                delivery: todayTransactions.filter(t => t.type === 'delivery').length
            };
            
            charts.transactionChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª', 'Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª', 'Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª', 'Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªØ³Ù„ÙŠÙ…'],
                    datasets: [{
                        data: [
                            transactionCounts.collection,
                            transactionCounts.deposit,
                            transactionCounts.expense,
                            transactionCounts.delivery
                        ],
                        backgroundColor: ['#10b981', '#3b82f6', '#ef4444', '#8b5cf6'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Agent Performance Chart for today only
            const ctx2 = document.getElementById('agentPerformanceChart').getContext('2d');
            
            if (charts.agentPerformanceChart) {
                charts.agentPerformanceChart.destroy();
            }
            
            const agentPerformance = {};
            allAgents.forEach(agent => {
                const agentTransactions = todayTransactions.filter(t => t.agent === agent.name && t.type === 'collection');
                agentPerformance[agent.name] = agentTransactions.reduce((sum, t) => sum + (t.amount || 0), 0);
            });
            
            const sortedAgents = Object.entries(agentPerformance)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
            
            charts.agentPerformanceChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: sortedAgents.map(([name]) => name),
                    datasets: [{
                        label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…',
                        data: sortedAgents.map(([, amount]) => amount),
                        backgroundColor: '#1e3a8a',
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ========== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ==========
        function updateAgentsDate() {
            const dateInput = document.getElementById('agentsDate');
            selectedAgentsDate = dateInput.value;
            updateAgentsList();
        }

        function showTodayAgents() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('agentsDate').value = today;
            selectedAgentsDate = today;
            updateAgentsList();
        }

        function resetAgentsDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('agentsDate').value = today;
            selectedAgentsDate = today;
            updateAgentsList();
        }

        async function updateAgentsList() {
            const agentsList = document.getElementById('agentsList');
            agentsList.innerHTML = '';
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
            const dateInfo = document.getElementById('agentsDateInfo');
            if (selectedAgentsDate === new Date().toISOString().split('T')[0]) {
                dateInfo.textContent = 'ÙŠØªÙ… Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·';
            } else {
                const dateObj = new Date(selectedAgentsDate);
                dateInfo.textContent = `ÙŠØªÙ… Ø¹Ø±Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† ÙÙŠ ØªØ§Ø±ÙŠØ®: ${dateObj.toLocaleDateString('en-US')}`;
            }
            
            if (allAgents.length === 0) {
                agentsList.innerHTML = `
                    <div class="col-span-full text-center py-8 md:py-12">
                        <i class="fas fa-users text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                        <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</p>
                    </div>
                `;
                return;
            }
            
            for (const agent of allAgents) {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ (Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·)
                const agentSelectedDateTransactions = allTransactions.filter(t => {
                    if (!t.timestamp || t.agent !== agent.name) return false;
                    const transactionDate = new Date(t.timestamp.toDate ? 
                        t.timestamp.toDate() : t.timestamp);
                    return transactionDate.toISOString().split('T')[0] === selectedAgentsDate;
                });
                
                const collections = agentSelectedDateTransactions.filter(t => t.type === 'collection');
                const deposits = agentSelectedDateTransactions.filter(t => t.type === 'deposit');
                const expenses = agentSelectedDateTransactions.filter(t => t.type === 'expense');
                const deliveries = agentSelectedDateTransactions.filter(t => t.type === 'delivery');
                
                const totalCollections = collections.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalDeposits = deposits.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalExpenses = expenses.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
                const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === agent.name);
                const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === agent.name);
                
                const totalReceived = receivedDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalSent = sentDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
                const previousBalance = await calculatePreviousDayBalance(agent.name, selectedAgentsDate);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù„ÙŠÙˆÙ… Ù…Ø­Ø¯Ø¯) Ù…Ø¹ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
                const currentBalance = previousBalance + totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
                
                const lastLogin = agent.lastLogin ? 
                    new Date(agent.lastLogin.toDate ? agent.lastLogin.toDate() : agent.lastLogin)
                        .toLocaleDateString('en-US') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                
                const div = document.createElement('div');
                div.className = 'agent-card rounded-xl md:rounded-2xl p-4 md:p-6 relative overflow-hidden';
                div.innerHTML = `
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-3 md:mb-4">
                            <div>
                                <h4 class="text-lg md:text-xl font-bold mb-1">${agent.name}</h4>
                                <p class="text-xs opacity-80">Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: ${lastLogin}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-xs opacity-70">Ø§Ù„Ø­Ø§Ù„Ø©</span>
                                <p class="text-xs md:text-sm font-semibold ${agent.isActive ? 'text-green-300' : 'text-red-300'}">
                                    ${agent.isActive ? 'ğŸŸ¢ Ù†Ø´Ø·' : 'ğŸ”´ ØºÙŠØ± Ù†Ø´Ø·'}
                                </p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
                            <div>
                                <p class="text-xs opacity-70">Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                                <p class="text-base md:text-lg font-bold">${formatAmount(totalCollections)}</p>
                            </div>
                            <div>
                                <p class="text-xs opacity-70">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
                                <p class="text-base md:text-lg font-bold ${currentBalance >= 0 ? 'text-green-300' : 'text-red-300'}">
                                    ${formatAmount(currentBalance)}
                                </p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <div>
                                <p class="text-xs opacity-70">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</p>
                                <p class="text-sm font-semibold">${formatAmount(previousBalance)}</p>
                            </div>
                            <div>
                                <p class="text-xs opacity-70">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                                <p class="text-sm font-semibold">${agentSelectedDateTransactions.length}</p>
                            </div>
                        </div>
                        <div class="flex justify-between text-xs md:text-sm">
                            <span class="opacity-70">Ø§Ø³ØªÙ„Ù… Ø§Ù„ÙŠÙˆÙ…:</span>
                            <span class="font-semibold text-green-300">${formatAmount(totalReceived)}</span>
                        </div>
                        <div class="flex justify-between text-xs md:text-sm">
                            <span class="opacity-70">Ø³Ù„Ù… Ø§Ù„ÙŠÙˆÙ…:</span>
                            <span class="font-semibold text-red-300">${formatAmount(totalSent)}</span>
                        </div>
                        <div class="flex flex-col gap-2 mt-3 md:mt-4">
                            <button onclick="showAgentDayDetails('${agent.name}', '${selectedAgentsDate}', ${previousBalance})" class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 py-2 rounded-lg transition-all text-sm md:text-base">
                                <i class="fas fa-chart-bar ml-1 md:ml-2"></i>Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…
                            </button>
                            <button onclick="showAgentStatement('${agent.name}')" class="w-full bg-white bg-opacity-20 hover:bg-opacity-30 py-2 rounded-lg transition-all text-sm md:text-base">
                                <i class="fas fa-file-invoice ml-1 md:ml-2"></i>ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ
                            </button>
                            <button onclick="deleteAgent('${agent.id}', '${agent.name}')" class="w-full bg-red-600 hover:bg-red-700 py-2 rounded-lg transition-all text-sm md:text-base">
                                <i class="fas fa-trash ml-1 md:ml-2"></i>Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                            </button>
                        </div>
                    </div>
                `;
                agentsList.appendChild(div);
            }
        }

        async function showAgentDayDetails(agentName, selectedDate, previousBalance) {
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
            const agentDayTransactions = allTransactions.filter(t => {
                if (!t.timestamp || t.agent !== agentName) return false;
                const transactionDate = new Date(t.timestamp.toDate ? 
                    t.timestamp.toDate() : t.timestamp);
                return transactionDate.toISOString().split('T')[0] === selectedDate;
            });

            const collections = agentDayTransactions.filter(t => t.type === 'collection');
            const deposits = agentDayTransactions.filter(t => t.type === 'deposit');
            const expenses = agentDayTransactions.filter(t => t.type === 'expense');
            const deliveries = agentDayTransactions.filter(t => t.type === 'delivery');
            
            const totalCollections = collections.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalDeposits = deposits.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalExpenses = expenses.reduce((sum, t) => sum + (t.amount || 0), 0);
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„
            const receivedDeliveries = deliveries.filter(t => t.deliveryType === 'receive' && t.toAgent === agentName);
            const sentDeliveries = deliveries.filter(t => t.deliveryType === 'send' && t.fromAgent === agentName);
            
            const totalReceived = receivedDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalSent = sentDeliveries.reduce((sum, t) => sum + (t.amount || 0), 0);
            
            const todayBalance = totalCollections + totalReceived - totalDeposits - totalExpenses - totalSent;
            const currentBalance = previousBalance + todayBalance;
            
            let report = `ğŸ¢  Ø£Ø¨ÙˆØ­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ‘¤ ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${agentName}\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(selectedDate).toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            report += `ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„ÙŠÙˆÙ… ${new Date(selectedDate).toLocaleDateString('en-US')}:\n`;
            report += `ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚: ${formatAmount(previousBalance)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª: ${formatAmount(totalCollections)} Ø±ÙŠØ§Ù„ (${collections.length} Ù…Ø¹Ø§Ù…Ù„Ø©)\n`;
            report += `ğŸ¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${formatAmount(totalDeposits)} Ø±ÙŠØ§Ù„ (${deposits.length} Ù…Ø¹Ø§Ù…Ù„Ø©)\n`;
            report += `ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${formatAmount(totalExpenses)} Ø±ÙŠØ§Ù„ (${expenses.length} Ù…Ø¹Ø§Ù…Ù„Ø©)\n`;
            report += `ğŸ“¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙ„Ù…: ${formatAmount(totalReceived)} Ø±ÙŠØ§Ù„ (${receivedDeliveries.length} Ù…Ø¹Ø§Ù…Ù„Ø©)\n`;
            report += `ğŸ“¤ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ù„Ù…: ${formatAmount(totalSent)} Ø±ÙŠØ§Ù„ (${sentDeliveries.length} Ù…Ø¹Ø§Ù…Ù„Ø©)\n`;
            report += `ğŸ“Š Ø±ØµÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(todayBalance)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ’µ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${formatAmount(currentBalance)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ“‹ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª: ${agentDayTransactions.length}\n\n`;
            
            // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
            if (collections.length > 0) {
                report += `ğŸ’° ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª:\n`;
                collections.forEach((collection, index) => {
                    const time = new Date(collection.timestamp.toDate ? collection.timestamp.toDate() : collection.timestamp)
                        .toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    let collectionInfo = `${collection.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${formatAmount(collection.amount)} Ø±.Ø³`;
                    
                    if (collection.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && collection.bankAccountName) {
                        collectionInfo += ` - ${collection.bankAccountName}`;
                    } else {
                        collectionInfo += ` - ${collection.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                    }
                    
                    report += `${index + 1}. ${collectionInfo} - ${time}\n`;
                });
                report += `\n`;
            }
            
            if (deposits.length > 0) {
                report += `ğŸ¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª:\n`;
                deposits.forEach((deposit, index) => {
                    const time = new Date(deposit.timestamp.toDate ? deposit.timestamp.toDate() : deposit.timestamp)
                        .toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    report += `${index + 1}. ${deposit.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${formatAmount(deposit.amount)} Ø±.Ø³ - ${time}\n`;
                });
                report += `\n`;
            }
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        // ========== ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ ==========
        async function showAgentStatement(agentName) {
            const agentTransactions = allTransactions
                .filter(t => t.agent === agentName)
                .sort((a, b) => {
                    const dateA = a.timestamp ? (a.timestamp.toDate ? a.timestamp.toDate() : new Date(a.timestamp)) : new Date(0);
                    const dateB = b.timestamp ? (b.timestamp.toDate ? b.timestamp.toDate() : new Date(b.timestamp)) : new Date(0);
                    return dateB - dateA;
                });

            let runningBalance = 0;
            const statementData = [];

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
            agentTransactions.forEach(transaction => {
                let amount = transaction.amount || 0;
                
                switch (transaction.type) {
                    case 'collection':
                        runningBalance += amount;
                        break;
                    case 'deposit':
                        runningBalance -= amount;
                        break;
                    case 'expense':
                        runningBalance -= amount;
                        break;
                    case 'delivery':
                        if (transaction.deliveryType === 'receive' && transaction.toAgent === agentName) {
                            runningBalance += amount;
                        } else if (transaction.deliveryType === 'send' && transaction.fromAgent === agentName) {
                            runningBalance -= amount;
                        }
                        break;
                }

                statementData.push({
                    date: formatDateTime(transaction.timestamp),
                    type: transaction.type,
                    description: getTransactionDescription(transaction),
                    amount: amount,
                    balance: runningBalance
                });
            });

            const statementContent = document.getElementById('agentStatementContent');
            statementContent.innerHTML = `
                <div class="bg-white rounded-lg p-4 md:p-6">
                    <h4 class="text-lg md:text-xl font-bold text-gray-800 mb-4">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ - ${agentName}</h4>
                    <div class="overflow-x-auto">
                        <table class="statement-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„ÙˆØµÙ</th>
                                    <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                                    <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${statementData.map(item => `
                                    <tr>
                                        <td>${item.date}</td>
                                        <td>${getTypeArabicName(item.type)}</td>
                                        <td>${item.description}</td>
                                        <td class="${getAmountColor(item.type, item.amount)}">${formatAmount(item.amount)}</td>
                                        <td class="${item.balance >= 0 ? 'text-green-600' : 'text-red-600'}">${formatAmount(item.balance)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <p class="text-lg font-bold ${runningBalance >= 0 ? 'text-green-600' : 'text-red-600'}">
                            Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${formatAmount(runningBalance)} Ø±ÙŠØ§Ù„
                        </p>
                    </div>
                </div>
            `;

            document.getElementById('statementTitle').textContent = `ÙƒØ´Ù Ø­Ø³Ø§Ø¨ ØªØ±Ø§ÙƒÙ…ÙŠ - ${agentName}`;
            document.getElementById('agentStatementModal').classList.remove('hidden');
        }

        function getTransactionDescription(transaction) {
            switch (transaction.type) {
                case 'collection':
                    return `ØªØ­ØµÙŠÙ„ Ù…Ù† ${transaction.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${transaction.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                case 'deposit':
                    return `Ø¥ÙŠØ¯Ø§Ø¹ ÙÙŠ ${transaction.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                case 'expense':
                    return `Ù…ØµØ±ÙˆÙ ${transaction.expenseType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} - ${transaction.description || ''}`;
                case 'delivery':
                    if (transaction.deliveryType === 'receive') {
                        return `Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† ${transaction.fromAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                    } else {
                        return `ØªØ³Ù„ÙŠÙ… Ø¥Ù„Ù‰ ${transaction.toAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                    }
                default:
                    return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function getTypeArabicName(type) {
            const types = {
                'collection': 'ØªØ­ØµÙŠÙ„',
                'deposit': 'Ø¥ÙŠØ¯Ø§Ø¹',
                'expense': 'Ù…ØµØ±ÙˆÙ',
                'delivery': 'Ø§Ø³ØªÙ„Ø§Ù…/ØªØ³Ù„ÙŠÙ…'
            };
            return types[type] || type;
        }

        function getAmountColor(type, amount) {
            if (type === 'collection' || (type === 'delivery' && amount > 0)) {
                return 'text-green-600';
            }
            return 'text-red-600';
        }

        function hideAgentStatementModal() {
            document.getElementById('agentStatementModal').classList.add('hidden');
        }

        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† - Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù ==========
        function showAddAgentModal() {
            document.getElementById('addAgentModal').classList.remove('hidden');
        }

        function hideAddAgentModal() {
            document.getElementById('addAgentModal').classList.add('hidden');
            document.getElementById('addAgentForm').reset();
        }

        async function addNewAgent() {
            const name = document.getElementById('newAgentName').value.trim();
            const email = document.getElementById('newAgentEmail').value.trim();
            const phone = document.getElementById('newAgentPhone').value.trim();

            if (!name) {
                showSuccessMessage('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
            const existingAgent = allAgents.find(agent => agent.name === name);
            if (existingAgent) {
                showSuccessMessage('Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }

            const agentData = {
                name: name,
                email: email || '',
                phone: phone || '',
                isActive: true,
                createdAt: new Date(),
                lastLogin: null
            };

            try {
                await db.collection('agents').add(agentData);
                showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¨Ù†Ø¬Ø§Ø­!');
                hideAddAgentModal();
                loadAgents(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
            } catch (error) {
                console.error('Error adding agent:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨');
            }
        }

        async function deleteAgent(agentId, agentName) {
            if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ "${agentName}"ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ Ø£ÙŠØ¶Ø§Ù‹.`)) {
                return;
            }

            try {
                // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£ÙˆÙ„Ø§Ù‹
                const agentTransactions = allTransactions.filter(t => t.agent === agentName);
                const batch = db.batch();
                
                for (const transaction of agentTransactions) {
                    const transactionRef = db.collection('transactions').doc(transaction.id);
                    batch.delete(transactionRef);
                }
                
                await batch.commit();

                // Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                await db.collection('agents').doc(agentId).delete();
                
                showSuccessMessage(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ "${agentName}" ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­!`);
                loadAllData(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                
            } catch (error) {
                console.error('Error deleting agent:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨');
            }
        }

        // ========== Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ==========
        function updateTransactionsList() {
            const tbody = document.getElementById('transactionsTableBody');
            tbody.innerHTML = '';
            
            document.getElementById('transactionsCount').textContent = `${filteredTransactions.length} Ù…Ø¹Ø§Ù…Ù„Ø©`;
            
            if (filteredTransactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 md:py-12">
                            <i class="fas fa-search text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                            <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50 transition-colors';
                
                const timestamp = formatDateTime(transaction.timestamp);
                
                let typeText = '';
                let details = '';
                let colorClass = '';
                
                switch (transaction.type) {
                    case 'collection':
                        typeText = 'ğŸ’° ØªØ­ØµÙŠÙ„';
                        details = `Ø§Ù„Ø¹Ù…ÙŠÙ„: ${transaction.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>Ø§Ù„Ù†ÙˆØ¹: ${transaction.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        
                        if (transaction.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && transaction.bankAccountName) {
                            details += `<br>Ø§Ù„Ø­Ø³Ø§Ø¨: ${transaction.bankAccountName}`;
                        }
                        
                        colorClass = 'text-green-600';
                        break;
                    case 'deposit':
                        typeText = 'ğŸ¦ Ø¥ÙŠØ¯Ø§Ø¹';
                        details = `Ø§Ù„Ø­Ø³Ø§Ø¨: ${transaction.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        colorClass = 'text-blue-600';
                        break;
                    case 'expense':
                        typeText = 'ğŸ’¸ Ù…ØµØ±ÙˆÙ';
                        details = `Ø§Ù„Ù†ÙˆØ¹: ${transaction.expenseType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>Ø§Ù„ÙˆØµÙ: ${transaction.description || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        colorClass = 'text-red-600';
                        break;
                    case 'delivery':
                        typeText = transaction.deliveryType === 'receive' ? 'ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù…' : 'ğŸ“¤ ØªØ³Ù„ÙŠÙ…';
                        details = `Ù…Ù† ${transaction.fromAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} Ø¥Ù„Ù‰ ${transaction.toAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`;
                        colorClass = 'text-purple-600';
                        break;
                }
                
                row.innerHTML = `
                    <td class="p-2 md:p-4 text-xs md:text-base">${timestamp}</td>
                    <td class="p-2 md:p-4 font-semibold text-xs md:text-base">${transaction.agent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                    <td class="p-2 md:p-4 text-xs md:text-base">${typeText}</td>
                    <td class="p-2 md:p-4 text-xs md:text-sm">${details}</td>
                    <td class="p-2 md:p-4 font-bold ${colorClass} text-xs md:text-base">${formatAmount(transaction.amount || 0)} Ø±ÙŠØ§Ù„</td>
                    <td class="p-2 md:p-4 text-xs md:text-base">
                        <div class="action-buttons">
                            <button onclick="editTransaction('${transaction.id}')" class="btn-edit text-white px-2 py-1 rounded text-xs">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('${transaction.id}')" class="btn-delete text-white px-2 py-1 rounded text-xs">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button onclick="shareTransaction('${transaction.id}')" class="btn-share text-white px-2 py-1 rounded text-xs">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateBankAccountsList() {
            const accountsList = document.getElementById('adminAccountsList');
            accountsList.innerHTML = '';
            
            if (allBankAccounts.length === 0) {
                accountsList.innerHTML = `
                    <div class="col-span-full text-center py-8 md:py-12">
                        <i class="fas fa-university text-4xl md:text-6xl text-gray-300 mb-3 md:mb-4"></i>
                        <p class="text-lg md:text-xl text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ù†ÙƒÙŠØ© Ù…Ø³Ø¬Ù„Ø©</p>
                    </div>
                `;
                return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶
            const dateInfo = document.getElementById('bankAccountsDateInfo');
            if (selectedBankAccountsDate === new Date().toISOString().split('T')[0]) {
                dateInfo.textContent = 'ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·';
            } else {
                const dateObj = new Date(selectedBankAccountsDate);
                dateInfo.textContent = `ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª ØªØ§Ø±ÙŠØ®: ${dateObj.toLocaleDateString('en-US')}`;
            }
            
            allBankAccounts.forEach(account => {
                // Ø­Ø³Ø§Ø¨ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø· Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨
                const selectedDateDeposits = allTransactions.filter(t => 
                    t.type === 'deposit' && 
                    t.bankAccountId === account.id &&
                    t.timestamp && 
                    new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedBankAccountsDate
                );
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª (Ø§Ù„ØªØ­ØµÙŠÙ„Ø§Øª Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©) Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯
                const selectedDateWithdrawals = allTransactions.filter(t => 
                    t.type === 'collection' && 
                    t.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' &&
                    t.bankAccountId === account.id &&
                    t.timestamp && 
                    new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedBankAccountsDate
                );
                
                const totalSelectedDateDeposits = selectedDateDeposits.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalSelectedDateWithdrawals = selectedDateWithdrawals.reduce((sum, t) => sum + (t.amount || 0), 0);
                const remaining = account.limit - totalSelectedDateDeposits;
                const usedPercentage = (totalSelectedDateDeposits / account.limit * 100).toFixed(1);
                
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙŠØ§Ù…)
                const accountAllDeposits = allTransactions.filter(t => 
                    t.type === 'deposit' && t.bankAccountId === account.id
                );
                const totalAllDeposits = accountAllDeposits.reduce((sum, t) => sum + (t.amount || 0), 0);
                
                const div = document.createElement('div');
                div.className = 'admin-card rounded-xl md:rounded-2xl p-4 md:p-6';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-3 md:mb-4">
                        <div>
                            <h4 class="text-lg md:text-xl font-bold text-gray-800 mb-1">${account.name}</h4>
                            <p class="text-xs md:text-sm text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${account.number}</p>
                            <p class="text-xs md:text-sm text-gray-600">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${account.cardNumber || '****'}</p>
                        </div>
                        <button onclick="shareAccountReport('${account.id}', '${selectedBankAccountsDate}')" class="bg-blue-600 text-white px-2 md:px-3 py-1 rounded-lg text-xs md:text-sm hover:bg-blue-700 transition-all">
                            <i class="fas fa-share-alt ml-1"></i>Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
                        <div>
                            <p class="text-xs text-gray-500">Ø§Ù„Ø³Ù‚Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</p>
                            <p class="text-base md:text-lg font-bold text-gray-800">${formatAmount(account.limit)} Ø±ÙŠØ§Ù„</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (${new Date(selectedBankAccountsDate).toLocaleDateString('en-US')})</p>
                            <p class="text-base md:text-lg font-bold text-blue-600">${formatAmount(totalSelectedDateDeposits)} Ø±ÙŠØ§Ù„</p>
                        </div>
                    </div>
                    <div class="mb-3 md:mb-4">
                        <div class="flex justify-between text-xs md:text-sm mb-1 md:mb-2">
                            <span class="text-gray-600">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</span>
                            <span class="font-semibold ${remaining > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${formatAmount(remaining)} Ø±ÙŠØ§Ù„ (${usedPercentage}%)
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 md:h-3">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 md:h-3 rounded-full transition-all" 
                                 style="width: ${Math.min(usedPercentage, 100)}%"></div>
                        </div>
                    </div>
                    <div class="text-xs md:text-sm text-gray-600">
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ: ${formatAmount(totalAllDeposits)} Ø±ÙŠØ§Ù„</p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª (Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø­Ø¯Ø¯): ${selectedDateDeposits.length}</p>
                        <p class="font-semibold text-red-600">Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(totalSelectedDateWithdrawals)} Ø±ÙŠØ§Ù„</p>
                    </div>
                    <div class="mt-3 md:mt-4 pt-3 md:pt-4 border-t border-gray-200">
                        <h5 class="text-sm font-semibold text-gray-700 mb-2">Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª ${new Date(selectedBankAccountsDate).toLocaleDateString('en-US')}:</h5>
                        <div class="max-h-32 overflow-y-auto">
                            ${selectedDateDeposits.length === 0 ? 
                                '<p class="text-xs text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>' : 
                                selectedDateDeposits.map(deposit => `
                                    <div class="flex justify-between items-center py-1 border-b border-gray-100">
                                        <span class="text-xs">${deposit.agent}</span>
                                        <span class="text-xs font-semibold">${formatAmount(deposit.amount)} Ø±.Ø³</span>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                    <div class="mt-2 pt-2 border-t border-gray-200">
                        <h5 class="text-sm font-semibold text-gray-700 mb-2">Ø³Ø­ÙˆØ¨Ø§Øª ${new Date(selectedBankAccountsDate).toLocaleDateString('en-US')}:</h5>
                        <div class="max-h-32 overflow-y-auto">
                            ${selectedDateWithdrawals.length === 0 ? 
                                '<p class="text-xs text-gray-500 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>' : 
                                selectedDateWithdrawals.map(withdrawal => `
                                    <div class="flex justify-between items-center py-1 border-b border-gray-100">
                                        <span class="text-xs">${withdrawal.agent} - ${withdrawal.customerName}</span>
                                        <span class="text-xs font-semibold text-red-600">${formatAmount(withdrawal.amount)} Ø±.Ø³</span>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
                accountsList.appendChild(div);
            });
        }

        // ========== Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥ÙƒÙ…Ø§Ù„ ==========
        function filterTransactions() {
            const agentFilter = document.getElementById('filterAgent').value;
            const typeFilter = document.getElementById('filterType').value;
            const specificDateFilter = document.getElementById('filterSpecificDate').value;
            const fromDateFilter = document.getElementById('filterFromDate').value;
            const toDateFilter = document.getElementById('filterToDate').value;

            filteredTransactions = allTransactions.filter(transaction => {
                // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                if (agentFilter && transaction.agent !== agentFilter) return false;
                
                // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                if (typeFilter && transaction.type !== typeFilter) return false;
                
                // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯
                if (specificDateFilter) {
                    const transactionDate = new Date(transaction.timestamp.toDate ? 
                        transaction.timestamp.toDate() : transaction.timestamp);
                    const filterDate = new Date(specificDateFilter);
                    
                    if (transactionDate.toISOString().split('T')[0] !== filterDate.toISOString().split('T')[0]) {
                        return false;
                    }
                }
                
                // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
                if (fromDateFilter || toDateFilter) {
                    const transactionDate = new Date(transaction.timestamp.toDate ? 
                        transaction.timestamp.toDate() : transaction.timestamp);
                    
                    if (fromDateFilter) {
                        const fromDate = new Date(fromDateFilter);
                        if (transactionDate < fromDate) return false;
                    }
                    
                    if (toDateFilter) {
                        const toDate = new Date(toDateFilter);
                        toDate.setDate(toDate.getDate() + 1); // Ù„Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø£ÙƒÙ…Ù„Ù‡
                        if (transactionDate >= toDate) return false;
                    }
                }
                
                return true;
            });
            
            updateTransactionsList();
        }

        function editTransaction(transactionId) {
            const transaction = allTransactions.find(t => t.id === transactionId);
            if (!transaction) return;

            document.getElementById('editTransactionId').value = transactionId;
            document.getElementById('editTransactionType').value = transaction.type;
            document.getElementById('editTransactionAmount').value = transaction.amount || 0;
            document.getElementById('editTransactionNotes').value = transaction.notes || '';

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            toggleEditTransactionFields();

            if (transaction.type === 'collection') {
                document.getElementById('editCustomerName').value = transaction.customerName || '';
                document.getElementById('editCollectionType').value = transaction.collectionType || 'Ù†Ù‚Ø¯ÙŠ';
            } else if (transaction.type === 'deposit') {
                document.getElementById('editBankAccount').value = transaction.bankAccountId || '';
            } else if (transaction.type === 'expense') {
                document.getElementById('editExpenseType').value = transaction.expenseType || 'Ø£Ø®Ø±Ù‰';
                document.getElementById('editExpenseDescription').value = transaction.description || '';
            } else if (transaction.type === 'delivery') {
                document.getElementById('editDeliveryType').value = transaction.deliveryType || 'receive';
                document.getElementById('editDeliveryAgent').value = 
                    transaction.deliveryType === 'receive' ? transaction.fromAgent : transaction.toAgent;
            }

            document.getElementById('editTransactionModal').classList.remove('hidden');
        }

        function toggleEditTransactionFields() {
            const type = document.getElementById('editTransactionType').value;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
            document.getElementById('editCollectionFields').classList.add('hidden');
            document.getElementById('editDepositFields').classList.add('hidden');
            document.getElementById('editExpenseFields').classList.add('hidden');
            document.getElementById('editDeliveryFields').classList.add('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯
            if (type === 'collection') {
                document.getElementById('editCollectionFields').classList.remove('hidden');
            } else if (type === 'deposit') {
                document.getElementById('editDepositFields').classList.remove('hidden');
            } else if (type === 'expense') {
                document.getElementById('editExpenseFields').classList.remove('hidden');
            } else if (type === 'delivery') {
                document.getElementById('editDeliveryFields').classList.remove('hidden');
            }
        }

        async function updateTransaction() {
            const transactionId = document.getElementById('editTransactionId').value;
            const type = document.getElementById('editTransactionType').value;
            const amount = parseFloat(document.getElementById('editTransactionAmount').value);
            const notes = document.getElementById('editTransactionNotes').value;

            const updateData = {
                type: type,
                amount: amount,
                notes: notes,
                updatedAt: new Date()
            };

            try {
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                if (type === 'collection') {
                    updateData.customerName = document.getElementById('editCustomerName').value;
                    updateData.collectionType = document.getElementById('editCollectionType').value;
                } else if (type === 'deposit') {
                    updateData.bankAccountId = document.getElementById('editBankAccount').value;
                    const bankAccount = allBankAccounts.find(a => a.id === updateData.bankAccountId);
                    if (bankAccount) {
                        updateData.bankAccount = `${bankAccount.name} - ${bankAccount.number}`;
                    }
                } else if (type === 'expense') {
                    updateData.expenseType = document.getElementById('editExpenseType').value;
                    updateData.description = document.getElementById('editExpenseDescription').value;
                } else if (type === 'delivery') {
                    updateData.deliveryType = document.getElementById('editDeliveryType').value;
                    if (updateData.deliveryType === 'receive') {
                        updateData.fromAgent = document.getElementById('editDeliveryAgent').value;
                        updateData.toAgent = ''; // Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                    } else {
                        updateData.fromAgent = ''; // Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
                        updateData.toAgent = document.getElementById('editDeliveryAgent').value;
                    }
                }

                await db.collection('transactions').doc(transactionId).update(updateData);
                showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                hideEditTransactionModal();
                loadAllData();
            } catch (error) {
                console.error('Error updating transaction:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
            }
        }

        function hideEditTransactionModal() {
            document.getElementById('editTransactionModal').classList.add('hidden');
        }

        async function deleteTransaction(transactionId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©ØŸ')) {
                return;
            }

            try {
                await db.collection('transactions').doc(transactionId).delete();
                showSuccessMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                loadAllData();
            } catch (error) {
                console.error('Error deleting transaction:', error);
                showSuccessMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
            }
        }

        function shareTransaction(transactionId) {
            const transaction = allTransactions.find(t => t.id === transactionId);
            if (!transaction) return;

            let report = `ğŸ¢  Ø£Ø¨ÙˆØ­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDateTime(transaction.timestamp)}\n`;
            report += `ğŸ‘¤ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨: ${transaction.agent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
            report += `ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${formatAmount(transaction.amount || 0)} Ø±ÙŠØ§Ù„\n`;
            
            switch (transaction.type) {
                case 'collection':
                    report += `ğŸ“Š Ø§Ù„Ù†ÙˆØ¹: ØªØ­ØµÙŠÙ„\n`;
                    report += `ğŸ‘¥ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${transaction.customerName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    report += `ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ­ØµÙŠÙ„: ${transaction.collectionType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    if (transaction.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' && transaction.bankAccountName) {
                        report += `ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨: ${transaction.bankAccountName}\n`;
                    }
                    break;
                case 'deposit':
                    report += `ğŸ“Š Ø§Ù„Ù†ÙˆØ¹: Ø¥ÙŠØ¯Ø§Ø¹\n`;
                    report += `ğŸ¦ Ø§Ù„Ø­Ø³Ø§Ø¨: ${transaction.bankAccount || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    break;
                case 'expense':
                    report += `ğŸ“Š Ø§Ù„Ù†ÙˆØ¹: Ù…ØµØ±ÙˆÙ\n`;
                    report += `ğŸ“ Ø§Ù„ÙˆØµÙ: ${transaction.description || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    report += `ğŸ”§ Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ: ${transaction.expenseType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    break;
                case 'delivery':
                    report += `ğŸ“Š Ø§Ù„Ù†ÙˆØ¹: ${transaction.deliveryType === 'receive' ? 'Ø§Ø³ØªÙ„Ø§Ù…' : 'ØªØ³Ù„ÙŠÙ…'}\n`;
                    report += `ğŸ‘¤ Ù…Ù†: ${transaction.fromAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    report += `ğŸ‘¥ Ø¥Ù„Ù‰: ${transaction.toAgent || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\n`;
                    break;
            }
            
            if (transaction.notes) {
                report += `ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${transaction.notes}\n`;
            }
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function copyToClipboard() {
            const shareText = document.getElementById('shareText');
            shareText.select();
            document.execCommand('copy');
            showSuccessMessage('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
        }

        function hideShareModal() {
            document.getElementById('shareModal').classList.add('hidden');
        }

        function updateBankAccountsDate() {
            const dateInput = document.getElementById('bankAccountsDate');
            selectedBankAccountsDate = dateInput.value;
            updateBankAccountsList();
        }

        function showTodayBankAccounts() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bankAccountsDate').value = today;
            selectedBankAccountsDate = today;
            updateBankAccountsList();
        }

        function resetBankAccountsDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bankAccountsDate').value = today;
            selectedBankAccountsDate = today;
            updateBankAccountsList();
        }

        function shareAccountReport(accountId, selectedDate) {
            const account = allBankAccounts.find(a => a.id === accountId);
            if (!account) return;

            const selectedDateDeposits = allTransactions.filter(t => 
                t.type === 'deposit' && 
                t.bankAccountId === accountId &&
                t.timestamp && 
                new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedDate
            );
            
            const selectedDateWithdrawals = allTransactions.filter(t => 
                t.type === 'collection' && 
                t.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' &&
                t.bankAccountId === accountId &&
                t.timestamp && 
                new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedDate
            );
            
            const totalSelectedDateDeposits = selectedDateDeposits.reduce((sum, t) => sum + (t.amount || 0), 0);
            const totalSelectedDateWithdrawals = selectedDateWithdrawals.reduce((sum, t) => sum + (t.amount || 0), 0);
            const remaining = account.limit - totalSelectedDateDeposits;
            const usedPercentage = (totalSelectedDateDeposits / account.limit * 100).toFixed(1);

            let report = `ğŸ¢  Ø£Ø¨ÙˆØ­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ¦ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(selectedDate).toLocaleDateString('en-US')}\n\n`;
            report += `ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:\n`;
            report += `ğŸ›ï¸  Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${account.name}\n`;
            report += `ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: ${account.number}\n`;
            report += `ğŸ’³ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${account.cardNumber || '****'}\n\n`;
            report += `ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡:\n`;
            report += `ğŸ’° Ø§Ù„Ø³Ù‚Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${formatAmount(account.limit)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(totalSelectedDateDeposits)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ“‰ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${formatAmount(totalSelectedDateWithdrawals)} Ø±ÙŠØ§Ù„\n`;
            report += `ğŸ’µ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatAmount(remaining)} Ø±ÙŠØ§Ù„ (${usedPercentage}%)\n\n`;
            
            if (selectedDateDeposits.length > 0) {
                report += `ğŸ“¥ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª:\n`;
                selectedDateDeposits.forEach((deposit, index) => {
                    const time = new Date(deposit.timestamp.toDate ? deposit.timestamp.toDate() : deposit.timestamp)
                        .toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    report += `${index + 1}. ${deposit.agent} - ${formatAmount(deposit.amount)} Ø±.Ø³ - ${time}\n`;
                });
                report += `\n`;
            }
            
            if (selectedDateWithdrawals.length > 0) {
                report += `ğŸ“¤ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª:\n`;
                selectedDateWithdrawals.forEach((withdrawal, index) => {
                    const time = new Date(withdrawal.timestamp.toDate ? withdrawal.timestamp.toDate() : withdrawal.timestamp)
                        .toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    report += `${index + 1}. ${withdrawal.agent} - ${withdrawal.customerName} - ${formatAmount(withdrawal.amount)} Ø±.Ø³ - ${time}\n`;
                });
            }
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function shareAllAccountsReport() {
            let report = `ğŸ¢  Ø£Ø¨ÙˆØ­Ø°ÙŠÙØ© Ù„Ù„ØµØ±Ø§ÙØ© ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª\n`;
            report += `ğŸ¦ ØªÙ‚Ø±ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙƒÙŠØ©\n`;
            report += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date(selectedBankAccountsDate).toLocaleDateString('en-US')}\n`;
            report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
            
            allBankAccounts.forEach((account, index) => {
                const selectedDateDeposits = allTransactions.filter(t => 
                    t.type === 'deposit' && 
                    t.bankAccountId === account.id &&
                    t.timestamp && 
                    new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedBankAccountsDate
                );
                
                const selectedDateWithdrawals = allTransactions.filter(t => 
                    t.type === 'collection' && 
                    t.collectionType === 'Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©' &&
                    t.bankAccountId === account.id &&
                    t.timestamp && 
                    new Date(t.timestamp.toDate ? t.timestamp.toDate() : t.timestamp).toISOString().split('T')[0] === selectedBankAccountsDate
                );
                
                const totalSelectedDateDeposits = selectedDateDeposits.reduce((sum, t) => sum + (t.amount || 0), 0);
                const totalSelectedDateWithdrawals = selectedDateWithdrawals.reduce((sum, t) => sum + (t.amount || 0), 0);
                const remaining = account.limit - totalSelectedDateDeposits;
                const usedPercentage = (totalSelectedDateDeposits / account.limit * 100).toFixed(1);
                
                report += `${index + 1}. ${account.name} - ${account.number}\n`;
                report += `   ğŸ’° Ø§Ù„Ø³Ù‚Ù: ${formatAmount(account.limit)} Ø±ÙŠØ§Ù„\n`;
                report += `   ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${formatAmount(totalSelectedDateDeposits)} Ø±ÙŠØ§Ù„\n`;
                report += `   ğŸ“‰ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª: ${formatAmount(totalSelectedDateWithdrawals)} Ø±ÙŠØ§Ù„\n`;
                report += `   ğŸ’µ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${formatAmount(remaining)} Ø±ÙŠØ§Ù„ (${usedPercentage}%)\n\n`;
            });
            
            document.getElementById('shareText').value = report;
            document.getElementById('shareModal').classList.remove('hidden');
        }

        function exportAgentsReport() {
            // ØªÙ†ÙÙŠØ° ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
            showSuccessMessage('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†...');
        }

        function exportTransactionsToExcel() {
            // ØªÙ†ÙÙŠØ° ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¥Ù„Ù‰ Excel
            showSuccessMessage('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¥Ù„Ù‰ Excel...');
        }

        function exportTransactionsToPDF() {
            // ØªÙ†ÙÙŠØ° ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¥Ù„Ù‰ PDF
            showSuccessMessage('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¥Ù„Ù‰ PDF...');
        }

        function generateReport() {
            // ØªÙ†ÙÙŠØ° Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            showSuccessMessage('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...');
        }

        function shareGeneratedReport() {
            // ØªÙ†ÙÙŠØ° Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙÙ†Ø´Ø£
            showSuccessMessage('Ø¬Ø§Ø±ÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±...');
        }

        function updateAnalytics() {
            // ØªÙ†ÙÙŠØ° ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
            // Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø·Ù‚ Ù‡Ù†Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹
        }

        function refreshDashboard() {
            loadAllData();
            showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        function showSuccessMessage(message) {
            const successMessage = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            
            successText.textContent = message;
            successMessage.classList.remove('hidden');
            
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        }

        async function resetAllLimits() {
            // ØªÙ†ÙÙŠØ° Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¯ÙˆØ¯
            showSuccessMessage('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©');
        }
    </script>
</body>
</html>
