<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام التقارير المتطور - شركة أبو حذيفة</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e74c3c;
            --accent-blue: #3498db;
            --accent-green: #2ecc71;
            --accent-orange: #f39c12;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
            --light-text: #ecf0f1;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
            padding: 10px;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
        }
        
        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 15px 0;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            margin-left: 10px;
            background-color: white;
            border-radius: 50%;
            padding: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 50%;
        }
        
        .header-text {
            text-align: right;
        }
        
        .header-text h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .header-text p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 15px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 15px;
            cursor: pointer;
            background: #f1f1f1;
            transition: background 0.3s;
            font-weight: 600;
            flex-grow: 1;
            text-align: center;
        }
        
        .tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .input-section, .preview-section, .accounts-section, .delivery-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary-color);
            color: var(--primary-color);
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
            margin-top: 8px;
        }
        
        button:hover {
            background-color: #c0392b;
        }
        
        .btn-generate {
            background-color: var(--accent-green);
        }
        
        .btn-generate:hover {
            background-color: #27ae60;
        }
        
        .btn-share {
            background-color: var(--accent-blue);
        }
        
        .btn-share:hover {
            background-color: #2980b9;
        }
        
        .btn-excel {
            background-color: #27ae60;
        }
        
        .btn-excel:hover {
            background-color: #219653;
        }
        
        .btn-transfer {
            background-color: var(--accent-orange);
        }
        
        .btn-transfer:hover {
            background-color: #e67e22;
        }
        
        .buttons-container {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .buttons-container button {
            margin: 5px;
            flex: 1;
            min-width: 120px;
        }
        
        .report-preview {
            background: white;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            min-height: 400px;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .report-header h2 {
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .report-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .summary-item {
            background: var(--light-bg);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .summary-item h3 {
            font-size: 14px;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        
        .summary-item p {
            font-size: 16px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        th, td {
            padding: 8px 10px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
        }
        
        th {
            background-color: var(--primary-color);
            color: var(--light-text);
            font-size: 14px;
        }
        
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .action-btn {
            padding: 4px 8px;
            font-size: 12px;
            margin: 0 2px;
        }
        
        .report-footer {
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-style: italic;
            color: #777;
            font-size: 14px;
        }
        
        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 15px;
            background-color: var(--accent-green);
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        
        .accounts-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px;
        }
        
        .account-item {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .account-item:last-child {
            border-bottom: none;
        }
        
        .account-actions button {
            margin-top: 0;
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .data-management {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .data-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .data-buttons button {
            flex: 1;
            min-width: 120px;
        }
        
        .saved-reports {
            margin-top: 15px;
        }
        
        .report-item {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-payment {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 4px solid var(--accent-blue);
        }
        
        .delivery-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 15px;
        }
        
        @media (min-width: 768px) {
            .delivery-form {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .delivery-list {
            margin-top: 20px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .delivery-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .delivery-item:last-child {
            border-bottom: none;
        }
        
        .delivery-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #ffeaa7;
            color: #d35400;
        }
        
        .status-completed {
            background-color: #d5f5e3;
            color: #27ae60;
        }
        
        .share-options {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
            flex-direction: column;
            gap: 5px;
        }
        
        .share-option {
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        
        .share-option:hover {
            background-color: #f1f1f1;
        }
        
        @media (max-width: 768px) {
            .header-text h1 {
                font-size: 18px;
            }
            
            .tab {
                padding: 10px;
                font-size: 14px;
            }
            
            .report-summary {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 6px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <div class="logo">
                    <img src="https://i.ibb.co/whLbwk4s/20250730-012920.png" alt="شعار شركة أبو حذيفة">
                </div>
                <div class="header-text">
                    <h1>شركة أبو حذيفة</h1>
                    <p>نظام إدارة تقارير التحصيل والإيداع المتطور</p>
                </div>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="input">إدخال البيانات</div>
            <div class="tab" data-tab="delivery">تسليم المندوبين</div>
            <div class="tab" data-tab="accounts">إدارة الحسابات</div>
            <div class="tab" data-tab="reports">التقارير المحفوظة</div>
        </div>

        <div class="tab-content active" id="input-tab">
            <div class="main-content">
                <div class="input-section">
                    <h2 class="section-title">إدخال البيانات</h2>
                    
                    <div class="form-group">
                        <label for="collector-name">اسم المندوب:</label>
                        <input type="text" id="collector-name" placeholder="أدخل اسم المندوب">
                    </div>
                    
                    <div class="form-group">
                        <label for="report-date">تاريخ التقرير:</label>
                        <input type="date" id="report-date">
                    </div>
                    
                    <h3 style="margin: 15px 0 10px; color: var(--primary-color);">بيانات التحصيل</h3>
                    
                    <div class="form-group">
                        <label for="collection-type">نوع التحصيل:</label>
                        <select id="collection-type">
                            <option value="نقدي">نقدي</option>
                            <option value="تحويل">تحويل</option>
                            <option value="سحب من البطاقة">سحب من البطاقة</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="client-name">اسم العميل:</label>
                        <input type="text" id="client-name" placeholder="أدخل اسم العميل">
                    </div>
                    
                    <div class="form-group">
                        <label for="collection-amount">مبلغ التحصيل (ريال):</label>
                        <input type="number" id="collection-amount" placeholder="أدخل المبلغ المحصل">
                    </div>
                    
                    <div id="card-payment-section" class="card-payment" style="display: none;">
                        <div class="form-group">
                            <label for="card-owner">صاحب البطاقة:</label>
                            <input type="text" id="card-owner" placeholder="أدخل اسم صاحب البطاقة">
                        </div>
                        
                        <div class="form-group">
                            <label for="card-last-digits">آخر 4 أرقام من البطاقة:</label>
                            <input type="text" id="card-last-digits" placeholder="أدخل آخر 4 أرقام" maxlength="4">
                        </div>
                    </div>
                    
                    <button id="add-collection">إضافة تحصيل</button>
                    
                    <h3 style="margin: 20px 0 10px; color: var(--primary-color);">بيانات الإيداع</h3>
                    
                    <div class="form-group">
                        <label for="deposit-name">اسم المستفيد:</label>
                        <select id="deposit-name">
                            <option value="">اختر حساب الإيداع</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="deposit-amount">مبلغ الإيداع (ريال):</label>
                        <input type="number" id="deposit-amount" placeholder="أدخل مبلغ الإيداع">
                    </div>
                    
                    <button id="add-deposit">إضافة إيداع</button>
                    
                    <h3 style="margin: 20px 0 10px; color: var(--primary-color);">المصروفات والنثريات</h3>
                    
                    <div class="form-group">
                        <label for="expense-type">نوع المصروف:</label>
                        <select id="expense-type">
                            <option value="مصاريف للبيت">مصاريف للبيت</option>
                            <option value="نثريات">نثريات</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="expense-amount">المبلغ (ريال):</label>
                        <input type="number" id="expense-amount" placeholder="أدخل مبلغ المصروف">
                    </div>
                    
                    <div class="form-group">
                        <label for="expense-details">تفاصيل إضافية (اختياري):</label>
                        <textarea id="expense-details" rows="2" placeholder="أضف أي تفاصيل إضافية"></textarea>
                    </div>
                    
                    <button id="add-expense">إضافة مصروف</button>

                    <div class="data-management">
                        <h3 style="margin: 20px 0 10px; color: var(--primary-color);">إدارة البيانات</h3>
                        <div class="data-buttons">
                            <button id="save-report">حفظ التقرير</button>
                            <button id="clear-data">مسح الكل</button>
                            <button id="load-last">تحميل آخر بيانات</button>
                        </div>
                    </div>
                </div>

                <div class="preview-section">
                    <h2 class="section-title">معاينة التقرير</h2>
                    
                    <div class="report-preview" id="report-preview">
                        <div class="report-header">
                            <h2>تقرير التحصيل والإيداع اليومي</h2>
                            <p>شركة أبو حذيفة</p>
                            <p id="preview-date">التاريخ: -</p>
                            <p id="preview-collector">اسم المندوب: -</p>
                        </div>
                        
                        <div class="report-summary">
                            <div class="summary-item">
                                <h3>إجمالي التحصيلات</h3>
                                <p id="total-collection">0 ريال</p>
                            </div>
                            <div class="summary-item">
                                <h3>إجمالي الإيداعات</h3>
                                <p id="total-deposit">0 ريال</p>
                            </div>
                            <div class="summary-item">
                                <h3>إجمالي المصروفات</h3>
                                <p id="total-expense">0 ريال</p>
                            </div>
                            <div class="summary-item">
                                <h3>المبلغ المتبقي</h3>
                                <p id="remaining-amount">0 ريال</p>
                            </div>
                        </div>
                        
                        <h3>تفاصيل التحصيلات</h3>
                        <table id="collections-table">
                            <thead>
                                <tr>
                                    <th>العميل/النوع</th>
                                    <th>المبلغ (ريال)</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملؤها بالبيانات -->
                            </tbody>
                        </table>
                        
                        <h3>تفاصيل الإيداعات</h3>
                        <table id="deposits-table">
                            <thead>
                                <tr>
                                    <th>المستفيد</th>
                                    <th>المبلغ (ريال)</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملؤها بالبيانات -->
                            </tbody>
                        </table>
                        
                        <h3>تفاصيل المصروفات</h3>
                        <table id="expenses-table">
                            <thead>
                                <tr>
                                    <th>النوع</th>
                                    <th>المبلغ (ريال)</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- سيتم ملؤها بالبيانات -->
                            </tbody>
                        </table>
                        
                        <div class="report-footer">
                            <p>تم إنشاء هذا التقرير تلقائياً بواسطة نظام التقارير الإلكتروني لشركة أبو حذيفة</p>
                        </div>
                    </div>
                    
                    <div class="buttons-container">
                        <button id="generate-report" class="btn-generate">توليد التقرير</button>
                        <div style="position: relative;">
                            <button id="share-pdf" class="btn-share">مشاركة PDF</button>
                            <div id="pdf-share-options" class="share-options">
                                <div class="share-option" onclick="downloadPdf()">
                                    <i class="fas fa-download"></i> تحميل PDF
                                </div>
                                <div class="share-option" onclick="shareViaEmail('pdf')">
                                    <i class="fas fa-envelope"></i> مشاركة عبر البريد
                                </div>
                                <div class="share-option" onclick="shareViaWhatsApp('pdf')">
                                    <i class="fab fa-whatsapp"></i> مشاركة عبر واتساب
                                </div>
                            </div>
                        </div>
                        <div style="position: relative;">
                            <button id="share-excel" class="btn-excel">مشاركة Excel</button>
                            <div id="excel-share-options" class="share-options">
                                <div class="share-option" onclick="downloadExcel()">
                                    <i class="fas fa-download"></i> تحميل Excel
                                </div>
                                <div class="share-option" onclick="shareViaEmail('excel')">
                                    <i class="fas fa-envelope"></i> مشاركة عبر البريد
                                </div>
                                <div class="share-option" onclick="shareViaWhatsApp('excel')">
                                    <i class="fab fa-whatsapp"></i> مشاركة عبر واتساب
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="delivery-tab">
            <div class="delivery-section">
                <h2 class="section-title">تسليم المندوبين</h2>
                
                <div class="delivery-form">
                    <div class="form-group">
                        <label for="from-collector">تسليم من مندوب:</label>
                        <input type="text" id="from-collector" placeholder="اسم المندوب المسلّم">
                    </div>
                    
                    <div class="form-group">
                        <label for="to-collector">إلى مندوب:</label>
                        <input type="text" id="to-collector" placeholder="اسم المندوب المستلم">
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-amount">المبلغ المسلّم (ريال):</label>
                        <input type="number" id="delivery-amount" placeholder="المبلغ المنقول">
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-date">تاريخ التسليم:</label>
                        <input type="date" id="delivery-date">
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-reason">سبب التسليم/الإخلاء:</label>
                        <select id="delivery-reason">
                            <option value="إخلاء نهائي">إخلاء نهائي</option>
                            <option value="إخلاء مؤقت">إخلاء مؤقت</option>
                            <option value="تغطية منطقة">تغطية منطقة</option>
                            <option value="مساعدة في التحصيل">مساعدة في التحصيل</option>
                            <option value="أخرى">أخرى</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="delivery-notes">ملاحظات إضافية:</label>
                        <textarea id="delivery-notes" rows="2" placeholder="أضف أي ملاحظات إضافية"></textarea>
                    </div>
                </div>
                
                <button id="add-delivery" class="btn-transfer">تسجيل عملية التسليم</button>
                
                <h3 style="margin: 20px 0 10px; color: var(--primary-color);">عمليات التسليم المسجلة</h3>
                <div class="delivery-list" id="delivery-list">
                    <!-- سيتم ملؤها بعمليات التسليم -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="accounts-tab">
            <div class="accounts-section">
                <h2 class="section-title">إدارة حسابات الإيداع</h2>
                
                <div class="form-group">
                    <label for="new-account-name">اسم الحساب الجديد:</label>
                    <input type="text" id="new-account-name" placeholder="أدخل اسم الحساب">
                </div>
                
                <div class="form-group">
                    <label for="new-account-number">رقم الحساب (اختياري):</label>
                    <input type="text" id="new-account-number" placeholder="أدخل رقم الحساب">
                </div>
                
                <button id="add-account">إضافة حساب</button>
                
                <h3 style="margin: 20px 0 10px; color: var(--primary-color);">الحسابات المسجلة</h3>
                <div class="accounts-list" id="accounts-list">
                    <!-- سيتم ملؤها بالحسابات -->
                </div>
            </div>
        </div>

        <div class="tab-content" id="reports-tab">
            <div class="saved-reports">
                <h2 class="section-title">التقارير المحفوظة</h2>
                <div id="saved-reports-list">
                    <!-- سيتم ملؤها بالتقرير المحفوظة -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // بيانات التقرير
        let reportData = {
            collectorName: '',
            reportDate: '',
            collections: [],
            deposits: [],
            expenses: []
        };

        // بيانات الحسابات
        let accounts = [];

        // بيانات التسليم
        let deliveries = [];

        // عناصر DOM
        const collectorNameInput = document.getElementById('collector-name');
        const reportDateInput = document.getElementById('report-date');
        const collectionTypeInput = document.getElementById('collection-type');
        const clientNameInput = document.getElementById('client-name');
        const collectionAmountInput = document.getElementById('collection-amount');
        const cardPaymentSection = document.getElementById('card-payment-section');
        const cardOwnerInput = document.getElementById('card-owner');
        const cardLastDigitsInput = document.getElementById('card-last-digits');
        const depositNameInput = document.getElementById('deposit-name');
        const depositAmountInput = document.getElementById('deposit-amount');
        const expenseTypeInput = document.getElementById('expense-type');
        const expenseAmountInput = document.getElementById('expense-amount');
        const expenseDetailsInput = document.getElementById('expense-details');
        const newAccountNameInput = document.getElementById('new-account-name');
        const newAccountNumberInput = document.getElementById('new-account-number');
        
        // عناصر التسليم
        const fromCollectorInput = document.getElementById('from-collector');
        const toCollectorInput = document.getElementById('to-collector');
        const deliveryAmountInput = document.getElementById('delivery-amount');
        const deliveryDateInput = document.getElementById('delivery-date');
        const deliveryReasonInput = document.getElementById('delivery-reason');
        const deliveryNotesInput = document.getElementById('delivery-notes');
        
        // عناصر المعاينة
        const previewDate = document.getElementById('preview-date');
        const previewCollector = document.getElementById('preview-collector');
        const totalCollectionElem = document.getElementById('total-collection');
        const totalDepositElem = document.getElementById('total-deposit');
        const totalExpenseElem = document.getElementById('total-expense');
        const remainingAmountElem = document.getElementById('remaining-amount');
        const collectionsTableBody = document.querySelector('#collections-table tbody');
        const depositsTableBody = document.querySelector('#deposits-table tbody');
        const expensesTableBody = document.querySelector('#expenses-table tbody');
        const accountsList = document.getElementById('accounts-list');
        const savedReportsList = document.getElementById('saved-reports-list');
        const deliveryList = document.getElementById('delivery-list');
        
        // الأزرار
        const addCollectionBtn = document.getElementById('add-collection');
        const addDepositBtn = document.getElementById('add-deposit');
        const addExpenseBtn = document.getElementById('add-expense');
        const addAccountBtn = document.getElementById('add-account');
        const addDeliveryBtn = document.getElementById('add-delivery');
        const generateReportBtn = document.getElementById('generate-report');
        const sharePdfBtn = document.getElementById('share-pdf');
        const shareExcelBtn = document.getElementById('share-excel');
        const saveReportBtn = document.getElementById('save-report');
        const clearDataBtn = document.getElementById('clear-data');
        const loadLastBtn = document.getElementById('load-last');
        
        // خيارات المشاركة
        const pdfShareOptions = document.getElementById('pdf-share-options');
        const excelShareOptions = document.getElementById('excel-share-options');
        
        // التبويبات
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // تهيئة الصفحة
        function init() {
            // تعيين تاريخ اليوم كتاريخ افتراضي
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            reportDateInput.value = formattedDate;
            reportData.reportDate = formattedDate;
            deliveryDateInput.value = formattedDate;
            
            // تحميل البيانات من localStorage
            loadDataFromStorage();
            
            // تحديث واجهة المستخدم
            updateAccountsDropdown();
            updateAccountsList();
            updateSavedReportsList();
            updateDeliveriesList();
            updatePreview();
            
            // إضافة مستمعي الأحداث
            setupEventListeners();
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // التبويبات
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    activateTab(tabId);
                });
            });
            
            // تغيير نوع التحصيل
            collectionTypeInput.addEventListener('change', function() {
                if (this.value === 'سحب من البطاقة') {
                    cardPaymentSection.style.display = 'block';
                } else {
                    cardPaymentSection.style.display = 'none';
                }
            });
            
            // تحديث المعاينة عند تغيير اسم المندوب أو التاريخ
            collectorNameInput.addEventListener('input', function() {
                reportData.collectorName = this.value;
                updatePreview();
            });
            
            reportDateInput.addEventListener('change', function() {
                reportData.reportDate = this.value;
                updatePreview();
            });
            
            // إضافة تحصيل
            addCollectionBtn.addEventListener('click', addCollection);
            
            // إضافة إيداع
            addDepositBtn.addEventListener('click', addDeposit);
            
            // إضافة مصروف
            addExpenseBtn.addEventListener('click', addExpense);
            
            // إضافة حساب
            addAccountBtn.addEventListener('click', addAccount);
            
            // إضافة تسليم
            addDeliveryBtn.addEventListener('click', addDelivery);
            
            // توليد التقرير
            generateReportBtn.addEventListener('click', generateReport);
            
            // مشاركة PDF
            sharePdfBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                pdfShareOptions.style.display = 'flex';
                excelShareOptions.style.display = 'none';
            });
            
            // مشاركة Excel
            shareExcelBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                excelShareOptions.style.display = 'flex';
                pdfShareOptions.style.display = 'none';
            });
            
            // إغلاق قوائم المشاركة عند النقر خارجها
            document.addEventListener('click', function() {
                pdfShareOptions.style.display = 'none';
                excelShareOptions.style.display = 'none';
            });
            
            // منع إغلاق القوائم عند النقر عليها
            pdfShareOptions.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            excelShareOptions.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // حفظ التقرير
            saveReportBtn.addEventListener('click', saveReport);
            
            // مسح البيانات
            clearDataBtn.addEventListener('click', clearData);
            
            // تحميل آخر بيانات
            loadLastBtn.addEventListener('click', loadLastData);
        }

        // تحميل البيانات من localStorage
        function loadDataFromStorage() {
            // تحميل الحسابات
            const savedAccounts = localStorage.getItem('depositAccounts');
            if (savedAccounts) {
                accounts = JSON.parse(savedAccounts);
            } else {
                // بيانات افتراضية (الحسابات المطلوبة)
                accounts = [
                    { name: 'دادية - شركة دروب سيول التعاون', accountNumber: '01400031966804' },
                    { name: 'دادية - شركة ترابط النوادر الأهليه', accountNumber: '50200000522607' },
                    { name: 'القاسمي - ALHANOUF S. AL ALQUTB', accountNumber: '01400029026609' },
                    { name: 'المقبولي - شركة بكري علي أحمد الشيخي', accountNumber: '25600001040609' },
                    { name: 'دادية - تلال الوفاء (زغلول)', accountNumber: '01400032556202' }
                ];
                localStorage.setItem('depositAccounts', JSON.stringify(accounts));
            }
            
            // تحميل آخر تقرير
            const lastReport = localStorage.getItem('lastReportData');
            if (lastReport) {
                reportData = JSON.parse(lastReport);
                
                // تعبئة الحقول
                collectorNameInput.value = reportData.collectorName || '';
                reportDateInput.value = reportData.reportDate || '';
            }
            
            // تحميل عمليات التسليم
            const savedDeliveries = localStorage.getItem('deliveries');
            if (savedDeliveries) {
                deliveries = JSON.parse(savedDeliveries);
            }
        }

        // تحديث قائمة الحسابات في dropdown
        function updateAccountsDropdown() {
            depositNameInput.innerHTML = '<option value="">اختر حساب الإيداع</option>';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.name;
                option.textContent = `${account.name} ${account.accountNumber ? `(${account.accountNumber})` : ''}`;
                depositNameInput.appendChild(option);
            });
        }

        // تحديث قائمة الحسابات المعروضة
        function updateAccountsList() {
            accountsList.innerHTML = '';
            accounts.forEach((account, index) => {
                const accountItem = document.createElement('div');
                accountItem.className = 'account-item';
                accountItem.innerHTML = `
                    <div>
                        <strong>${account.name}</strong>
                        ${account.accountNumber ? `<br><small>رقم الحساب: ${account.accountNumber}</small>` : ''}
                    </div>
                    <div class="account-actions">
                        <button onclick="deleteAccount(${index})">حذف</button>
                    </div>
                `;
                accountsList.appendChild(accountItem);
            });
        }

        // تحديث قائمة عمليات التسليم
        function updateDeliveriesList() {
            deliveryList.innerHTML = '';
            
            if (deliveries.length === 0) {
                deliveryList.innerHTML = '<p>لا توجد عمليات تسليم مسجلة</p>';
                return;
            }
            
            deliveries.forEach((delivery, index) => {
                const deliveryItem = document.createElement('div');
                deliveryItem.className = 'delivery-item';
                deliveryItem.innerHTML = `
                    <div>
                        <strong>من ${delivery.fromCollector} إلى ${delivery.toCollector}</strong>
                        <br><small>المبلغ: ${delivery.amount.toLocaleString()} ريال</small>
                        <br><small>التاريخ: ${delivery.date}</small>
                        <br><small>السبب: ${delivery.reason}</small>
                    </div>
                    <div>
                        <span class="delivery-status status-completed">مكتمل</span>
                        <button class="action-btn" onclick="deleteDelivery(${index})">حذف</button>
                    </div>
                `;
                deliveryList.appendChild(deliveryItem);
            });
        }

        // تحديث قائمة التقارير المحفوظة
        function updateSavedReportsList() {
            savedReportsList.innerHTML = '';
            const reports = getSavedReports();
            
            if (reports.length === 0) {
                savedReportsList.innerHTML = '<p>لا توجد تقارير محفوظة</p>';
                return;
            }
            
            reports.forEach((report, index) => {
                const reportItem = document.createElement('div');
                reportItem.className = 'report-item';
                reportItem.innerHTML = `
                    <div>
                        <strong>تقرير ${report.date}</strong>
                        <br><small>المندوب: ${report.collectorName}</small>
                    </div>
                    <div>
                        <button onclick="loadSavedReport(${index})">تحميل</button>
                        <button onclick="deleteSavedReport(${index})">حذف</button>
                    </div>
                `;
                savedReportsList.appendChild(reportItem);
            });
        }

        // الحصول على التقارير المحفوظة
        function getSavedReports() {
            const savedReports = localStorage.getItem('savedReports');
            return savedReports ? JSON.parse(savedReports) : [];
        }

        // حفظ التقرير
        function saveReport() {
            if (!reportData.collectorName) {
                showNotification('يرجى إدخال اسم المندوب', 'error');
                return;
            }
            
            if (reportData.collections.length === 0 && reportData.deposits.length === 0 && reportData.expenses.length === 0) {
                showNotification('لا توجد بيانات لحفظها', 'error');
                return;
            }
            
            const reports = getSavedReports();
            const reportToSave = {
                date: reportData.reportDate,
                collectorName: reportData.collectorName,
                data: {...reportData}
            };
            
            reports.push(reportToSave);
            localStorage.setItem('savedReports', JSON.stringify(reports));
            
            showNotification('تم حفظ التقرير بنجاح');
            updateSavedReportsList();
        }

        // تحميل تقرير محفوظ
        function loadSavedReport(index) {
            const reports = getSavedReports();
            if (reports[index]) {
                reportData = {...reports[index].data};
                
                // تعبئة الحقول
                collectorNameInput.value = reportData.collectorName || '';
                reportDateInput.value = reportData.reportDate || '';
                
                updatePreview();
                activateTab('input');
                showNotification('تم تحميل التقرير بنجاح');
            }
        }

        // حذف تقرير محفوظ
        function deleteSavedReport(index) {
            const reports = getSavedReports();
            reports.splice(index, 1);
            localStorage.setItem('savedReports', JSON.stringify(reports));
            updateSavedReportsList();
            showNotification('تم حذف التقرير بنجاح');
        }

        // مسح البيانات
        function clearData() {
            if (confirm('هل أنت متأكد من أنك تريد مسح جميع البيانات؟')) {
                reportData = {
                    collectorName: reportData.collectorName,
                    reportDate: reportData.reportDate,
                    collections: [],
                    deposits: [],
                    expenses: []
                };
                
                // مسح الحقول
                clientNameInput.value = '';
                collectionAmountInput.value = '';
                depositAmountInput.value = '';
                expenseAmountInput.value = '';
                expenseDetailsInput.value = '';
                cardOwnerInput.value = '';
                cardLastDigitsInput.value = '';
                
                updatePreview();
                showNotification('تم مسح البيانات بنجاح');
            }
        }

        // تحميل آخر بيانات
        function loadLastData() {
            const lastReport = localStorage.getItem('lastReportData');
            if (lastReport) {
                const lastData = JSON.parse(lastReport);
                reportData.collections = lastData.collections || [];
                reportData.deposits = lastData.deposits || [];
                reportData.expenses = lastData.expenses || [];
                
                updatePreview();
                showNotification('تم تحميل آخر بيانات بنجاح');
            } else {
                showNotification('لا توجد بيانات سابقة', 'error');
            }
        }

        // إضافة تحصيل
        function addCollection() {
            const type = collectionTypeInput.value;
            const clientName = clientNameInput.value.trim();
            const amount = parseFloat(collectionAmountInput.value);
            const cardOwner = cardOwnerInput.value.trim();
            const cardLastDigits = cardLastDigitsInput.value.trim();
            
            if (!clientName || isNaN(amount) || amount <= 0) {
                showNotification('يرجى إدخال بيانات التحصيل بشكل صحيح', 'error');
                return;
            }
            
            if (type === 'سحب من البطاقة' && (!cardOwner || !cardLastDigits)) {
                showNotification('يرجى إدخال بيانات البطاقة', 'error');
                return;
            }
            
            let displayName = clientName;
            if (type === 'سحب من البطاقة') {
                displayName = `${clientName} (سحب من بطاقة: ${cardOwner} - ${cardLastDigits})`;
            }
            
            reportData.collections.push({
                type,
                clientName,
                displayName,
                amount,
                cardOwner,
                cardLastDigits
            });
            
            clientNameInput.value = '';
            collectionAmountInput.value = '';
            cardOwnerInput.value = '';
            cardLastDigitsInput.value = '';
            cardPaymentSection.style.display = 'none';
            collectionTypeInput.value = 'نقدي';
            
            updatePreview();
            saveToLocalStorage();
            showNotification('تم إضافة التحصيل بنجاح');
        }

        // إضافة إيداع
        function addDeposit() {
            const depositName = depositNameInput.value;
            const amount = parseFloat(depositAmountInput.value);
            
            if (!depositName || isNaN(amount) || amount <= 0) {
                showNotification('يرجى إدخال بيانات الإيداع بشكل صحيح', 'error');
                return;
            }
            
            // البحث عن رقم الحساب إذا كان موجوداً
            let accountNumber = '';
            const account = accounts.find(acc => acc.name === depositName);
            if (account) {
                accountNumber = account.accountNumber || '';
            }
            
            reportData.deposits.push({
                depositName,
                accountNumber,
                amount
            });
            
            depositNameInput.value = '';
            depositAmountInput.value = '';
            
            updatePreview();
            saveToLocalStorage();
            showNotification('تم إضافة الإيداع بنجاح');
        }

        // إضافة مصروف
        function addExpense() {
            const type = expenseTypeInput.value;
            const amount = parseFloat(expenseAmountInput.value);
            const details = expenseDetailsInput.value.trim();
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('يرجى إدخال مبلغ المصروف بشكل صحيح', 'error');
                return;
            }
            
            reportData.expenses.push({
                type,
                amount,
                details: details || 'لا يوجد'
            });
            
            expenseAmountInput.value = '';
            expenseDetailsInput.value = '';
            
            updatePreview();
            saveToLocalStorage();
            showNotification('تم إضافة المصروف بنجاح');
        }

        // إضافة تسليم
        function addDelivery() {
            const fromCollector = fromCollectorInput.value.trim();
            const toCollector = toCollectorInput.value.trim();
            const amount = parseFloat(deliveryAmountInput.value);
            const date = deliveryDateInput.value;
            const reason = deliveryReasonInput.value;
            const notes = deliveryNotesInput.value.trim();
            
            if (!fromCollector || !toCollector || isNaN(amount) || amount <= 0 || !date) {
                showNotification('يرجى إدخال بيانات التسليم بشكل صحيح', 'error');
                return;
            }
            
            deliveries.push({
                fromCollector,
                toCollector,
                amount,
                date,
                reason,
                notes: notes || 'لا يوجد'
            });
            
            // مسح الحقول
            fromCollectorInput.value = '';
            toCollectorInput.value = '';
            deliveryAmountInput.value = '';
            deliveryNotesInput.value = '';
            
            // حفظ في localStorage
            localStorage.setItem('deliveries', JSON.stringify(deliveries));
            
            updateDeliveriesList();
            showNotification('تم تسجيل عملية التسليم بنجاح');
        }

        // حذف تحصيل
        function deleteCollection(index) {
            if (confirm('هل تريد حذف هذا التحصيل؟')) {
                reportData.collections.splice(index, 1);
                updatePreview();
                saveToLocalStorage();
                showNotification('تم حذف التحصيل بنجاح');
            }
        }

        // حذف إيداع
        function deleteDeposit(index) {
            if (confirm('هل تريد حذف هذا الإيداع؟')) {
                reportData.deposits.splice(index, 1);
                updatePreview();
                saveToLocalStorage();
                showNotification('تم حذف الإيداع بنجاح');
            }
        }

        // حذف مصروف
        function deleteExpense(index) {
            if (confirm('هل تريد حذف هذا المصروف؟')) {
                reportData.expenses.splice(index, 1);
                updatePreview();
                saveToLocalStorage();
                showNotification('تم حذف المصروف بنجاح');
            }
        }

        // حذف تسليم
        function deleteDelivery(index) {
            if (confirm('هل تريد حذف عملية التسليم هذه؟')) {
                deliveries.splice(index, 1);
                localStorage.setItem('deliveries', JSON.stringify(deliveries));
                updateDeliveriesList();
                showNotification('تم حذف عملية التسليم بنجاح');
            }
        }

        // إضافة حساب
        function addAccount() {
            const name = newAccountNameInput.value.trim();
            const accountNumber = newAccountNumberInput.value.trim();
            
            if (!name) {
                showNotification('يرجى إدخال اسم الحساب', 'error');
                return;
            }
            
            accounts.push({
                name,
                accountNumber
            });
            
            newAccountNameInput.value = '';
            newAccountNumberInput.value = '';
            
            localStorage.setItem('depositAccounts', JSON.stringify(accounts));
            updateAccountsDropdown();
            updateAccountsList();
            showNotification('تم إضافة الحساب بنجاح');
        }

        // حذف حساب
        function deleteAccount(index) {
            if (confirm('هل أنت متأكد من أنك تريد حذف هذا الحساب؟')) {
                accounts.splice(index, 1);
                localStorage.setItem('depositAccounts', JSON.stringify(accounts));
                updateAccountsDropdown();
                updateAccountsList();
                showNotification('تم حذف الحساب بنجاح');
            }
        }

        // حفظ البيانات إلى localStorage
        function saveToLocalStorage() {
            localStorage.setItem('lastReportData', JSON.stringify(reportData));
        }

        // تحديث معاينة التقرير
        function updatePreview() {
            // تحديث التاريخ واسم المندوب
            previewDate.textContent = `التاريخ: ${reportData.reportDate || '-'}`;
            previewCollector.textContent = `اسم المندوب: ${reportData.collectorName || '-'}`;
            
            // حساب المجاميع
            const totalCollection = reportData.collections.reduce((sum, item) => sum + item.amount, 0);
            const totalDeposit = reportData.deposits.reduce((sum, item) => sum + item.amount, 0);
            const totalExpense = reportData.expenses.reduce((sum, item) => sum + item.amount, 0);
            const remainingAmount = totalCollection - totalDeposit - totalExpense;
            
            // تحديث العناصر
            totalCollectionElem.textContent = `${totalCollection.toLocaleString()} ريال`;
            totalDepositElem.textContent = `${totalDeposit.toLocaleString()} ريال`;
            totalExpenseElem.textContent = `${totalExpense.toLocaleString()} ريال`;
            remainingAmountElem.textContent = `${remainingAmount.toLocaleString()} ريال`;
            
            // تحديث جدول التحصيلات
            collectionsTableBody.innerHTML = '';
            reportData.collections.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.displayName || item.clientName}</td>
                    <td>${item.amount.toLocaleString()}</td>
                    <td>
                        <button class="action-btn" onclick="deleteCollection(${index})">حذف</button>
                    </td>
                `;
                collectionsTableBody.appendChild(row);
            });
            
            // تحديث جدول الإيداعات
            depositsTableBody.innerHTML = '';
            reportData.deposits.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.depositName}</td>
                    <td>${item.amount.toLocaleString()}</td>
                    <td>
                        <button class="action-btn" onclick="deleteDeposit(${index})">حذف</button>
                    </td>
                `;
                depositsTableBody.appendChild(row);
            });
            
            // تحديث جدول المصروفات
            expensesTableBody.innerHTML = '';
            reportData.expenses.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.type}${item.details && item.details !== 'لا يوجد' ? ` (${item.details})` : ''}</td>
                    <td>${item.amount.toLocaleString()}</td>
                    <td>
                        <button class="action-btn" onclick="deleteExpense(${index})">حذف</button>
                    </td>
                `;
                expensesTableBody.appendChild(row);
            });
        }

        // توليد التقرير
        function generateReport() {
            if (!reportData.collectorName) {
                showNotification('يرجى إدخال اسم المندوب', 'error');
                return;
            }
            
            updatePreview();
            saveToLocalStorage();
            showNotification('تم تحديث التقرير بنجاح');
        }

        // تحميل PDF
        function downloadPdf() {
            if (!reportData.collectorName) {
                showNotification('يرجى إدخال اسم المندوب أولاً', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // استخدام html2canvas لالتقاط المحتوى وتحويله إلى صورة
            html2canvas(document.getElementById('report-preview')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = doc.internal.pageSize.getWidth();
                let imgHeight = canvas.height * imgWidth / canvas.width;
                
                // إذا كان التقرير طويلاً، نقسمه إلى عدة صفحات
                const pageHeight = doc.internal.pageSize.getHeight();
                let remainingHeight = imgHeight;
                let position = 0;
                
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                remainingHeight -= pageHeight;
                
                // إضافة صفحات إضافية إذا لزم الأمر
                while (remainingHeight > 0) {
                    position = remainingHeight - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    remainingHeight -= pageHeight;
                }
                
                // حفظ الملف
                const fileName = `تقرير_تحصيل_${reportData.reportDate}_${reportData.collectorName}.pdf`;
                doc.save(fileName);
                
                showNotification('تم تحميل التقرير بنجاح');
            });
        }

        // تحميل Excel
        function downloadExcel() {
            if (!reportData.collectorName) {
                showNotification('يرجى إدخال اسم المندوب أولاً', 'error');
                return;
            }
            
            // إنشاء مصنف Excel
            const wb = XLSX.utils.book_new();
            
            // إضافة ورقة للتحصيلات
            const collectionsData = [['نوع التحصيل', 'العميل', 'المبلغ (ريال)', 'ملاحظات']];
            reportData.collections.forEach(item => {
                let notes = '';
                if (item.type === 'سحب من البطاقة') {
                    notes = `صاحب البطاقة: ${item.cardOwner}, آخر 4 أرقام: ${item.cardLastDigits}`;
                }
                collectionsData.push([item.type, item.clientName, item.amount, notes]);
            });
            const wsCollections = XLSX.utils.aoa_to_sheet(collectionsData);
            XLSX.utils.book_append_sheet(wb, wsCollections, 'التحصيلات');
            
            // إضافة ورقة للإيداعات
            const depositsData = [['المستفيد', 'رقم الحساب', 'المبلغ (ريال)']];
            reportData.deposits.forEach(item => {
                depositsData.push([item.depositName, item.accountNumber || 'غير محدد', item.amount]);
            });
            const wsDeposits = XLSX.utils.aoa_to_sheet(depositsData);
            XLSX.utils.book_append_sheet(wb, wsDeposits, 'الإيداعات');
            
            // إضافة ورقة للمصروفات
            const expensesData = [['نوع المصروف', 'المبلغ (ريال)', 'التفاصيل']];
            reportData.expenses.forEach(item => {
                expensesData.push([item.type, item.amount, item.details]);
            });
            const wsExpenses = XLSX.utils.aoa_to_sheet(expensesData);
            XLSX.utils.book_append_sheet(wb, wsExpenses, 'المصروفات');
            
            // إضافة ورقة للملخص
            const totalCollection = reportData.collections.reduce((sum, item) => sum + item.amount, 0);
            const totalDeposit = reportData.deposits.reduce((sum, item) => sum + item.amount, 0);
            const totalExpense = reportData.expenses.reduce((sum, item) => sum + item.amount, 0);
            const remainingAmount = totalCollection - totalDeposit - totalExpense;
            
            const summaryData = [
                ['ملخص التقرير'],
                [''],
                ['إجمالي التحصيلات', totalCollection],
                ['إجمالي الإيداعات', totalDeposit],
                ['إجمالي المصروفات', totalExpense],
                ['المبلغ المتبقي', remainingAmount],
                [''],
                ['تاريخ التقرير', reportData.reportDate],
                ['اسم المندوب', reportData.collectorName]
            ];
            const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, wsSummary, 'ملخص التقرير');
            
            // حفظ الملف
            const fileName = `تقرير_تحصيل_${reportData.reportDate}_${reportData.collectorName}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('تم تحميل ملف Excel بنجاح');
        }

        // مشاركة عبر البريد
        function shareViaEmail(type) {
            const subject = `تقرير تحصيل - ${reportData.reportDate} - ${reportData.collectorName}`;
            const body = `مرفق تقرير التحصيل ليوم ${reportData.reportDate} للمندوب ${reportData.collectorName}`;
            
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            showNotification(`تم فتح نافذة البريد الإلكتروني لمشاركة ${type === 'pdf' ? 'PDF' : 'Excel'}`);
        }

        // مشاركة عبر واتساب
        function shareViaWhatsApp(type) {
            const text = `تقرير تحصيل - ${reportData.reportDate} - ${reportData.collectorName}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            
            showNotification(`تم فتح واتساب لمشاركة ${type === 'pdf' ? 'PDF' : 'Excel'}`);
        }

        // تفعيل تبويب
        function activateTab(tabId) {
            tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContents.forEach(content => {
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // وظيفة لعرض الإشعارات
        function showNotification(message, type = 'success') {
            // إزالة أي إشعارات سابقة
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                document.body.removeChild(notification);
            });
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // تهيئة الصفحة عند التحميل
        window.onload = init;
    </script>
</body>
</html>
